![](./media/image1.png)

# シンプルなユーザー モデルのサンプル

*このサンプルは 2022 年 6 月 の Microsoft Game Development Kit (10.0.22000.4362) と互換性があります*

# 説明

このサンプルでは、6 月の Microsoft ゲーム開発キットで導入された新しいシンプル ユーザー モデルを使用する方法を示します。

# サンプルのビルド

Xbox One 開発キットを使用している場合は、アクティブなソリューション プラットフォームを `Gaming.Xbox.XboxOne.x64` に設定します。

Xbox Series X|S 開発キットを使用している場合は、アクティブなソリューション プラットフォームを `Gaming.Xbox.Scarlett.x64` に設定します。

PC を使用している場合は、アクティブなソリューション プラットフォームを Gaming.Desktop.x64 に設定します。

*詳細については、**GDK ドキュメント*の「__サンプルの実行__」 を参照してください。

# サンプルの使用

開発キットで Simple User Model Sample を起動するには、まずユーザーにサインインし、既定の開発キット ユーザーを設定する必要があります。 既定のユーザーは、ユーザーの [自動サインイン] をオンにすることで、*Xbox One Manager GDK* を使用するユーザーにすることができます。 または、"xbconfig DefaultUser" 設定を使用して設定することもできます。 詳細については、Simple User Model に関するドキュメントを参照してください。

このサンプルは、既定のユーザーにサイレント モードでサインインし、ゲーマータグとゲーマーアイコンを画面に表示します。 ユーザーがゲーマータグまたはゲーマーアイコンを変更すると、画面でも更新されます。 \[View\] ボタンを押してサンプルを終了します。

![グラフィカル ユーザー インターフェイス、アプリケーション、自動生成された説明](./media/image3.png)

本体のみ: 既定のユーザーに割り当てられているコントローラーが切断されると、サンプルは `XUserFindControllerForUserWithUiAsync` を呼び出し、コントローラー入力を求める UI を起動します。 これにより、コントローラーが常に既定のユーザーとペアリングされます。

# 実装に関するメモ

新しい単純なユーザー モデルは、タイトルが 1 人の既定のユーザーを持つ場合にタイトルに必要なユーザー管理コードを大幅に簡略化します。 たとえば、シングルプレイヤー ゲーム、シングル ユーザーの常時オンライン タイトル、RPC などがあります。

サンプル コードを見るときは、"\[Simple User Model\]" コメントを検索して、単純なユーザー モデルの使用に関連する場所を検索します。

タイトルの単純なユーザー モデルを有効にするには、MicrosoftGame.config を編集し、次のエントリを追加する必要があります。

```xml
<!-- Opt into requiring a default user at launch and to use the simple user model. -->
<AdvancedUserModel>false</AdvancedUserModel>
```


現在、June 2022 GDK リリースでビルドされたタイトルの既定値は *true* です。 これは、将来の GDK メジャー リリースで既定で *false* に変更される可能性があります。 2021 年 4 月より前のバージョンの GDK でビルドされたタイトルでは、この設定は存在せず、使用可能なユーザー モデルは高度なモデルのみです。

単純なユーザー モデルを使用すると、ユーザーのサインイン/サインアウト動作、ユーザー イベント、PLM (プロセス ライフタイム管理) イベント、および関連する機能が変更され、以前の高度なモデルを使用する場合よりも簡単な方法で処理できます。 変更と処理の簡略化方法については、次の表を参照してください。

| 機能 | シンプルなユーザー モデルを使用した処理 | 高度なユーザー モデルを使用した処理 |
|---|---|---|
| 既定のユーザー/プライマリ ユーザー | 本体では、Xbox ホーム画面からタイトルを起動するユーザーは、そのタイトルの有効期間の不変の既定のユーザーとして設定されます。 PC では、誰もサインインしていない場合、ゲームは終了し、PC ブートストラップが起動してユーザーのサインインを支援します。 それ以降の起動は、ユーザーが Xbox Live に完全にサインインしている限り、問題なく行うことができます。 | タイトルは、タイトルのプライマリ ユーザーを手動で確立して管理する必要があります。 詳細については、「[XR-112](https://developer.microsoft.com/en-us/games/xbox/partner/xr112)」 を参照してください。 |
| サインインとサインアウト | *XUserAddAsync* と *AddDefaultUserSilently* フラグを使用して既定のユーザーにサインインすると、サイレントに成功することが保証されます。 本体では、既定のユーザーがサインアウトした場合、タイトルは中断されます。 PC では、既定のユーザーがサインアウトした場合、タイトルは終了します。 既定のユーザー以外の追加ユーザーは、高度なユーザー モデルと同じように処理されます。 | サインイン試行の成功に関する想定は行われません。 ユーザーがサインアウトした場合、タイトルは自動的に中断されません。 代わりに、タイトルは [XR-115](https://developer.microsoft.com/en-us/games/xbox/partner/xr115) に従ってサインインとサインアウトを処理する必要があります。 |
| PLM | アプリケーションは、以前に起動したユーザーとは異なるユーザーで Xbox ホーム画面からタイトルを起動しようとすると、タイトルを終了します。 コンソールでは、アプリケーションが自動的に再起動します。 PC では、アプリケーションを手動で再起動する必要があります。 | すべての PLM イベントは、ユーザーやデバイスの変更/損失を引き起こすイベントを含め、それに応じて処理する必要があります。 |
| User イベント | 既定のユーザーは、サインイン/アウト関連のユーザー イベントを受け取りません。 追加のユーザーは、サインアウト/サインイン関連のイベントを受け取ります。 すべてのユーザーは、ゲーマータグやゲーマーアイコンの変更イベントなど、他のユーザー変更イベントを受け取ります。 | すべてのユーザーは、すべてのユーザー イベントを受信できます。 |

上の表で説明した動作は、PC または本体 (リテール 本体でテストする場合、または Xbox ホーム画面を使用して開発キットでアプリケーションを起動およびテストする場合) の動作です。

DevHome で開発キットを使用する場合、テスト ツールを使用して PLM をテストする場合、または他の開発キット アプリケーションを使用する場合、考慮すべき追加のケースがいくつかあります。

- 既定のユーザーをサインアウトし、新しいユーザーにサインインした後、Xbox Manager アプリケーションまたはその他の PLM テスト ツールを使用してタイトルを手動で再開した場合、既定のユーザーのユーザー サインアウト/サインイン関連イベントを取得できます。 このケースは、小売用途で処理する必要はありません。

- Xbox ホーム画面を使用して起動しない場合は、開発キットでタイトルを起動するための既定のユーザーを設定する必要があります。 これを行うには、Xbox Manager アプリケーションで [自動サインイン] をオンにするか、"xbconfig DefaultUser" 設定を使用します。

複数のユーザー、ユーザーのサインイン/アウト イベント、ゲームパッドのペアリング、XR 処理、およびその他の高度なユーザー トピックを処理する方法の詳細については、UserManagement サンプルを参照してください。

# 更新履歴

**2023 年 8 月 10 日:** コントローラーの紛失後にコントローラーをユーザーに再接続するシナリオを追加しました

**2022 年 6 月 24 日:** PC サポートを追加し、要件を June 2022 GDK にアップグレードしました

**初期リリース:** Microsoft Game Development Kit (2021 年 6 月)

# プライバシーに関する声明

サンプルをコンパイルして実行する場合、サンプルの使用状況を追跡するために、サンプルの実行可能ファイルのファイル名が Microsoft に送信されます。 このデータ コレクションからオプトアウトするには、Main.cpp の "サンプル使用状況テレメトリ" というラベルの付いたコードのブロックを削除します。

Microsoft のプライバシー ポリシー全般の詳細については、「[Microsoft のプライバシーに関する声明](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。


