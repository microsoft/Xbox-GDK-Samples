  ![](./media/image1.png)

#   简单用户模型示例

*此示例与 Microsoft 游戏开发工具包（2021 年 4 月）兼容*

# 

# 说明

此示例演示了如何使用 Microsoft 游戏开发工具包中新增的简单用户模型（2021
年 4 月）。

# 生成示例

如果使用 Xbox One 开发工具包，请将活动解决方案平台设置为
Gaming.Xbox.XboxOne.x64。

如果使用 Xbox Series X|S 开发工具包，请将活动解决方案平台设置为
Gaming.Xbox.Scarlett.x64。

*有关详细信息，请参阅 GDK 文档中的"*运行示例"*。*

# 使用示例

若要在开发工具包上启动简单用户模型示例，首先需要登录用户并设置默认的开发工具包用户。通过为用户勾选"自动登录"，默认用户可以是使用
*Xbox One Manager GDK* 的用户。或者，也可以使用"xbconfig
DefaultUser"设置来设置默认用户。有关详细信息，请参阅有关简单用户模型的文档。

该示例以无提示方式登录默认用户，并在屏幕上显示其玩家代号和玩家图片。如果用户更改了玩家代号或玩家图片，屏幕上也会更新相应信息。按\[视图\]按钮退出示例。

![Graphical user interface, application Description automatically generated](./media/image3.png)

# 实现说明

当游戏打算具有单个默认用户时，新推出的简单用户模型可以大大简化游戏所需的用户管理代码。示例可以包括单人游戏、单用户始终在线游戏、RPG
等等。

查看示例代码时，搜索"\[简单用户模型\]"注释来查找与使用相关简单用户模型有关的位置。

若要为游戏启用简单用户模型，需要编辑 MicrosoftGame.config
并添加以下条目：

```
<!--选择在启动时要求默认用户并使用简单用户模型。-->

<AdvancedUserModel>false</AdvancedUserModel>
```

对于使用 2021 年 4 月和 2021 年 6 月 GDK 版本生成的游戏，默认值当前为
*true*。在未来的 GDK 主要版本中，默认值可能更改为 *false*。在使用 2021
年 4 月之前的 GDK
版本生成的游戏上，此设置不存在，并且可用的用户模型只有高级模型。

使用简单用户模型时，用户登录/注销行为、用户事件、PLM（进程周期管理）事件和相关功能会发生更改，其处理方式比使用较旧的高级模型时要简单。有关更改以及如何简化进程的信息，请参阅下表：

| 功能  |  使用简单用户模型进行处理  |  使用高级用户模型进行处理 |
|----------|---------------------------------|------------------------|
| 默 认用户/ 主要用户  |  系统会将从 Xbox 主 屏幕启动游戏的用户，设置为该游 戏生命周期内不可变的默认用户。  |  游戏必须手动建立 和管理游戏的主要用户。 有关详细信息，请参阅 [XR-112](https://developer.microsoft.com/en-us/games/xbox/partner/xr112)。 |
| 登 录和注销  |  使用 *XUserAddAsync* 和 *AddDefaultUserSilently* 标志登录默 认用户可保证以静音模式下成功。 如果 默认用户已注销，则游戏将暂停。 除默认用户之外的其他用户的处理 方式与使用高级用户模型时相同。  | 无法对登录尝试成功做出任何假设。如果有任何用户注销，则游戏不会自动暂停。相反，游戏必须根据[XR-115](https://developer.microsoft.com/en-us/games/xbox/partner/xr115) 处理登录和注销。       |
| PLM  |  当尝试使用与 之前启动游戏的用户不同的用户从 Xbox 主屏幕启动游戏时，Xbox 系统将终止游戏并重新启动。 |  应妥当处理所有 PLM 事件，包括 导致用户和/或设备发生 更改/丢失的任何事件。  |
| 用户事件  |  默认用户从不会 收到与登录/输出相关的用户事件。 其他用户 则会收到与注销/登录相关的事件。 所有用 户都会收到其他用户更改事件，例 如玩家代号和玩家图片更改事件。 |  所有用户都 可以接收所有用户事件。 |

上表中所述的行为是在零售版主机上进行测试或使用 Xbox
主屏幕在开发工具包上启动和测试应用程序时发生的行为。将开发工具包与
DevHome 配合使用、使用测试工具或其他开发工具包应用程序测试 PLM
时，需要考虑一些额外的情况。

-   如果注销默认用户、登录新用户，然后使用 Xbox Manager 应用程序或其他
    PLM
    测试工具手动恢复游戏，则可以获取默认用户的用户注销/登录相关事件。零售版使用案例则无需处理这种情况。

-   如果未使用 Xbox
    主屏幕启动，则需要设置默认用户，以便在开发工具包上启动游戏。为此，可以在
    Xbox Manager 应用程序中或使用"xbconfig
    DefaultUser"勾选中"自动登录"。

有关如何处理多个用户、用户登录/注销事件、游戏手柄配对、XR
处理和其他更高级用户主题的详细信息，请参阅 UserManagement 示例。

# 更新历史记录

**初始版本：**Microsoft 游戏开发工具包（2021 年 6 月）

# 隐私声明

在编译和运行示例时，将向 Microsoft
发送示例可执行文件的文件名以帮助跟踪示例使用情况。若要选择退出此数据收集，你可以删除
Main.cpp 中标记为"示例使用遥测"的代码块。

有关 Microsoft 的一般隐私策略的详细信息，请参阅 [Microsoft
隐私声明](https://privacy.microsoft.com/en-us/privacystatement/)。
