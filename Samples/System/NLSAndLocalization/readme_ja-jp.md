  ![](./media/image1.png)

#   NLS とローカライズサンプル

*このサンプルは Microsoft Game Development Kit (2020 年 6 月)
と互換性があります。*

# 説明

このサンプルでは、MicrosoftGame.Config
で参照されている文字列とアセットをローカライズする方法と、ローカライズされたゲーム内リソースに適切にアクセスする方法を示します。一般的な
NLS (各国語サポート) API もいくつか示されています。

## メイン画面

![](./media/image3.png)

*この画像では、コンソール ユーザーの言語設定は es-AR です*

| 操作                        |  ゲームパッド       |  キーボード       |
|-----------------------------|--------------------|------------------|
| ボタンを選択して実行します  |  方向パッド上/下    |  方向キー/マウス  |
| ボタンを押す                |  ボ タン            |  入力/左クリック  |
| 終了                        |  ビュー ボタン      |  Esc キー         |

# サンプルのビルド

Xbox One 開発キットを使用している場合、アクティブ ソリューション
プラットフォームを Gaming.Xbox.XboxOne.x64 に設定します。

Xbox Series X|S 開発キットを使用している場合、アクティブ ソリューション
プラットフォームを Gaming.Xbox.Scarlett.x64 に設定します。

Windows 10 を使用している場合には、アクティブ ソリューション
プラットフォームを Gaming.Desktop.x64 に設定します。

*詳細については、GDK
のドキュメントの*サンプルの実行*を参照してください。*

# 実装上の注意

# このサンプルでは、タイトルのローカライズの基本を示します。サンプルで使用されているリソース パーサーは、エラー チェックを提示しない基本的なパーサーです。ゲームがこの構成に従う場合は、このリソース パーサーを直接コピーするのではなく、より完全な機能を備えたリソース パーサーがこのコンテキストでどのように機能するかの例としてこれを確認する必要があります。このサンプルの目的は、開発者がリソースのローカライズプロシージャを理解できるようにすることです。

**現在のローカライズ設定を列挙する**

# アプリケーションが起動すると、一般的な NLS API の出力が表示されます。「現在のローカライズ設定の列挙」 ボタンを押すと、手動で再度表示できます。

GetUserDefaultLocaleName API
はコンソールがセットされている位置を保留解除し、GetUserDefaultGeoName
API
はコンソールがセットされている位置を保留解除します。XPackageGetUserLocale
API は、パッケージ ロケールに最も近くマッチするユーザー
ロケールを保留解除します。 結果は LCID に変換できます。

**システム設定駆動型言語の選択**

このサンプルでは、アプリケーション言語の設定に基づいて、ゲーム内の画像とテキストが変更されます。サンプルの既定の言語は、XPackageGetUserLocale
API。によって決定されます。The XPackageGetUserLocale API
はユーザーのシステム上のタイトルに最もマッチするロケールを決定する、ロケール選択の本当のゲームのソースである必要があります。ロケールは、コンソールとユーザーの設定、タイトルでサポートされている内容など、使用可能なすべてのデータに基づいています。結果は常に、ゲームの構成で宣言されている言語、または言語が宣言されていない場合はユーザーの言語になります。このロケールは、ランタイムにサンプルによって使用され、表示する適切なローカライズされた画像とテキストを選択します。

このサンプルでは、MicrosoftGame.config で 以下のように7
つのロケールが定義されています。

-   

-   en-US

-   en-GB

-   zh-Hans-CN

-   zh-Hant

-   ja-JP

-   es

-   fr

これらのロケールは、一般的なフォールバック
シナリオを示すために選択されています。フォールバックは、コンソールの言語と位置の設定がゲームでサポートされている言語と正確に一致せず、使用可能なオプションから選択する必要がある場合に発生します。

たとえば、コンソール言語が「en-CA」 の場合、「en-GB」
にフォールバックします。もう 1 つのシナリオは 「fr」で
です。このサンプルでは、リージョンのない「 fr」
のみが定義されています。この場合、コンソールの言語がフランス語の場合、コンソール言語の地域に関係なく
「fr」 にフォールバックします。

コンソール設定では、ローカライズ設定が言語、言語の地域、場所の間で分けらることに注意してください。Xbox
One Manager では、優先言語は最初の 2 つをマージし、geography
型の地域は場所に対応します。このサンプルでは、言語の設定のみが言語の選択に影響します。つまり、場所/geography
型の地域は GetUserDefaultGeoNameにのみ影響します。

**MicrosoftGame.Config の文字列ローカリゼーション**

サンプルの表示名と説明も、コンソール言語に基づいてローカライズされます。ローカライズをサポートするには、MicrosoftGame.Config
のこれらのフィールドを ms-resource 参照に設定します。次に例を示します。

OverrideDisplayName=\"ms-resource:ApplicationDisplayName\"

これらの値は、それぞれのロケールの下にある Resources.resw
ファイルに存在する値に基づいて入力されます。たとえば、コンソール言語が日本語
(ja) に設定され、地域が日本 (JP)
に設定されている場合、表示名はプロジェクトの ja-JP フォルダーにある
Resources.resw ファイルから取得されます。このサンプルでは、「NLS And
Localization (ja-JP)」 という文字列になります。既定では、Resources.resw
ファイルと各言語フォルダーはルート プロジェクト
フォルダーにある必要があります。Resources.resw
ファイルが、このサンプルで使用される 「文字列」 ディレクトリ
(ProjectFolder\\Strings\\Resources.resw、ProjectFolder\\Strings\\ja-JP\\Resources.resw
など) など、別の場所にある場合は、プロジェクト プロパティ ページの
「パッケージローカライズ ディレクトリ」
プロパティでフォルダーを指定してください。

**MicrosoftGame.Config パッケージイメージローカライズ**

サンプルのパッケージ
イメージは、コンソール言語に基づいてローカライズすることもできます。まず、MicrosoftGame.config
でデフォルトのイメージのパスが通常どおりに指定されます。次のスニペットは、「イメージ」
ディレクトリの下のサンプル内のデフォルトイメージの場所を示しています。

StoreLogo=\"Images\\StoreLogo.png\"

Square480x480Logo=\"Images\\Square480x480Logo.png\"

Square150x150Logo=\"Images\\Square150x150Logo.png\"

Square44x44Logo=\"Images\\Square44x44Logo.png\"

SplashScreenImage=\"Images\\SplashScreen.png\"

そのつぎに、デフォルトイメージと同じディレクトリに、MicrosoftGame.config
で定義されている各言語のサブディレクトリには、ローカライズされたバリアント
(ProjectFolder\\Images\\ja-JP\\StoreLogo.png、ProjectFolder\\Images\\ja-JP\\Square480x480Logo.png
など)
が含まれます。すべての言語について、最初にその特定の言語フォルダーでイメージ
ファイルがチェックされ、使用可能な場合はそのファイルが使用されます。それ以外の場合で、イメージが言語フォルダーに見つからない場合または言語がサポートされていない場合
(つまり、言語フォルダーが存在しない場合)
は、デフォルトのロゴに落ち着きます。サンプルのビルド時に、各ロゴが Loose
フォルダーに正しくコピーされていることを確認してください。

MicrosoftGame.config
設定に対応する製品が実際に公開されていて、そのサンドボックス
(またはリテール)
のアカウントがサインイン済みの場合、文字列とイメージは、パートナー
センター製品ページで構成されている同等のフィールドによってオーバーライドできます。また、パートナー
センターのゲームとMicrosoft
Storeのリスティングでサポートされている言語の 1 対 1
の対応も必要ありませんが、非常に役に立ちます。

# 更新履歴

2020 年 4 月の初回リリース

2021年5月のサンプルは、UX の更新など、追加の NLS
機能をサポートするように更新されました。

2021 年 7 月 MicrosoftGame.config が更新されました

# プライバシーに関する声明

サンプルをコンパイルして実行する場合、サンプルの使用状況を追跡するために、サンプル実行ファイルのファイル名が
Microsoft に送信されます。このデータ
コレクションからオプトアウトするには、Main.cpp の「Sample Usage
Telemetry」というラベルの付いたコードのブロックを削除します。

全般的な Microsoft のプライバシー ポリシーの詳細については、「[Microsoft
プライバシー
ステートメント](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。
