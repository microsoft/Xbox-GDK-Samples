![](./media/image1.png)

# FastBlockCompress 샘플

*이 샘플은 Microsoft 게임 개발 키트(2022년 3월)와 호환됩니다.*

# 설명

이 샘플은 DirectCompute를 사용하여 런타임에 클래식 *Fast Block Compression* 알고리즘을 기반으로 하는 BC1, BC3 및 BC5 형식에 대해 빠른 텍스처 압축을 수행하는 방법을 보여줍니다. 또한 이 샘플에서는 런타임 및 오프라인 압축 모드 간에 전환하여 시각적 품질을 비교할 수도 있습니다.

![](./media/image2.jpeg)

# 샘플 빌드

Xbox One 개발 키트를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.XboxOne.x64`(으)로 설정합니다.

Xbox Series X|S를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.Scarlett.x64`(으)로 설정합니다.

*자세한 내용은* *GDK 설명서의* __샘플 실행을__ 참조하세요.&nbsp;

# 샘플 사용

| 동작 | Gamepad |
|---|---|
| 이전 또는 다음 이미지 | 왼쪽 또는 오른쪽 범퍼 |
| 이전 또는 다음 압축 방법 | 왼쪽 또는 오른쪽 방향 패드 |
| 이전 또는 다음 밉 수준 | 방향 패드를 아래 또는 위로 |
| 카메라 이동 | 오른쪽 스틱 |
| 확대/축소 | 왼쪽 또는 오른쪽 트리거 |
| 전체 화면 및 나란히 표시 | X |
| 강조 표시 블록 | A |
| 주기 차이 모드 | 예 |
| 끝내기 | 보기 버튼 |

# Background

Xbox One에는 독점 앱에서 사용할 수 있는 5GB 통합 메모리가 있으며, 이는 Xbox 360에서 제공되는 512MB의 10배에 달하는 극적인 증가입니다. 아쉽게도 IO 대역폭 및 스토리지 미디어 용량은 그 속도를 따라가지 못했습니다. 블루레이 미디어는 49GB를 보유하고 있으며, 이는 Xbox 360 게임 디스크 버전 3에서 사용할 수 있는 7.8GB의 6.3배에 불과합니다.

스트리밍 설치의 도입과 더불어 이러한 사실은 부하 시간을 최소화하고 게임 자산을 사용 가능한 스토리지 공간으로 압축하는 데 효율적인 압축 방법이 여전히 중요하다는 것을 의미합니다.

타이틀은 오프라인 이미지 압축 형식을 사용하여 게임 텍스처를 인코딩함으로써 많은 양의 스토리지 공간을 절약하기도 합니다. Xbox One에는 하드웨어 JPEG 디코더가 기본 제공되며, 이로 인해 JPEG가 매력적인 선택이 됩니다. 하지만 JPEG 하드웨어는 텍스처를 메모리에서 압축되지 않은 YUV 형식으로 디코딩하므로 렌더링에 적합하지 않습니다. 이 방법을 사용하는 경우 타이틀은 런타임에 GPU에서 지원하는 블록 압축 형식 중 하나로 텍스처를 다시 압축해야 합니다.

이 샘플에서는 GPU를 사용하여 텍스처를 BC1, BC3 및 BC5 형식으로 효율적으로 압축합니다. 오프라인 블록 압축에 사용되는 표준 알고리즘은 지금까지 너무 느려서 실시간으로 실행되지 않았으며 샘플에서 사용하는 알고리즘은 속도를 내기 위해 상당한 품질 저하를 일으킵니다.

메모리 대역폭은 현재 알고리즘에 병목 현상을 일으키기 때문에 다른 기술을 사용하면 약간의 성능 저하만으로 눈에 띄게 품질을 향상할 수 있습니다.

# 구현 참고 사항

샘플의 각 DirectCompute 압축 셰이더에는 1개 밉 버전, 2개 밉 버전, 테일 밉 버전의 세 가지 변형이 있습니다.

- 1개 밉 셰이더는 원본 텍스처의 단일 밉을 압축합니다.

- 2개 밉 셰이더는 원본 텍스처의 단일 밉을 읽고 LDS(로컬 데이터 저장소) 메모리로 밉을 다운 샘플링합니다. 다음으로 셰이더는 원래 버전과 다운 샘플링된 버전을 모두 압축한 다음, 출력 텍스처에 해당 밉 수준을 씁니다.

이 프로세스는 두 번째 밉 수준에 대한 원본 텍스처의 읽기를 방지하여 메모리 대역폭을 절약합니다. 그러나 실제로 성능 향상은 추가되는 셰이더 복잡성과 높은 GPR 및 LDS 사용으로 인한 점유율 감소로 인해 크게 상쇄됩니다.

- 테일 밉 셰이더는 다른 밉 수준에서 작업할 다른 스레드를 선택하여 단일 디스패치 호출에서 원본 텍스처의 16×16~1×1 밉 수준을 압축합니다.

최소 웨이브프론트 크기는 64개 스레드이므로 별도의 디스패치 호출에서 각 테일 밉을 압축하는 기술은 사용 가능한 스레드의 대부분을 낭비합니다. 단 하나의 웨이브프론트와 디스패치 호출을 사용함으로써 테일 밉 셰이더는 이 낭비되는 작업의 대부분을 피할 수 있습니다.

Direct3D는 BC 형식 텍스처를 UAV로 바인딩하는 것을 허용하지 않으므로 컴퓨트 셰이더에서 블록 압축 텍스처에 직접 쓸 수 없습니다. 이 샘플은 쓰기 가능한 형식의 중간 텍스처를 블록 압축 텍스처와 동일한 메모리 위치에 별칭을 지정하여 그러한 한계를 해결합니다. 중간 텍스처는 4분의 1 크기이며 각 텍셀은 압축된 텍스처의 블록에 해당합니다.

이러한 방식으로 텍스처 메모리에 별칭을 지정하려면 두 텍스처의 타일링 모드와 메모리 레이아웃이 정확히 일치해야 합니다. 또한 Direct3D는 메모리 별칭을 인식하지 못하므로 GPU는 동일한 메모리 위치에 별칭이 지정된 다른 리소스에서 작동하는 여러 그리기 또는 디스패치 호출을 동시에 예약하는 일이 발생할 수 있습니다.

즉, 중간 텍스처에 쓰는 셰이더는 별칭이 지정된 블록 압축 텍스처에서 읽는 그리기 호출과 동시에 예약될 수도 있습니다. 이러한 위험을 방지하려면 적절한 울타리를 수동으로 삽입해야 합니다.

오프라인 줄 압축 알고리즘은 [DirectXTex](https://github.com/Microsoft/DirectXTex/)에서 구현됩니다.

# 대안

이 샘플의 주요 목적은 클래식 "JPG/FBC" 솔루션을 런타임 시 디스크 내 텍스처 스토리지 및 메모리 내 소비를 최소화하는 다른 대안과 비교하는 테스트 사례를 제공하는 것입니다.

- Basis Universal([GitHub](https://github.com/BinomialLLC/basis_universal/)) - 이 솔루션은 디스크의 텍스처를 [ETC1](https://github.com/Ericsson/ETCPACK)의 변형으로 압축하며, 런타임 시 BC7(모드 6)을 비롯한 다양한 형식으로 변환할 수 있습니다. 이렇게 하면 클래식 JPG/FBC 파이프라인과 비슷하거나 그보다 더 나은 이미지 품질로 더 넓은 범위의 대상 GPU 배열을 지원할 뿐만 아니라 디스크 내 공간을 줄일 수 있습니다. .basis의 다중 GPU 트랜스코딩 측면은 콘솔 타이틀보다 모바일에 훨씬 더 유용하지만, 디스크 내 절약을 평가할 가치가 있는 형식입니다.

- XBTC - Xbox Series X|S에서 XBTC 압축 체계와 함께 DirectStorage를 사용할 수 있습니다. **TextureCompression** 샘플을 참조하세요.

# 참조 문서

Microsoft 고급 기술 그룹. 빠른 블록 압축 샘플. Xbox 360 SDK. 2010년 2월

Narkowicz, Krzysztof. "GPU에서 실시간 BC6H 압축". Wolfgang Engel(CRC Press)에서 편집한 *GPU Pro 7*. 2016. (219~228 페이지).

Tranchida, Jason. [GPU를 사용한 실시간 텍스처 압축](http://www.gdcvault.com/play/1012554/Texture-compression-in-real-time) GDC 2010년. 2010년 3월

van Waveren, J.M.P[. 실시간 DXT 압축](https://software.intel.com/sites/default/files/23/1d/324337_324337.pdf). Intel Software Network. 2006년 5월.

van Waveren, J.M.P., Castaño, Ignacio. [실시간 YCoCg-DXT 압축](https://www.nvidia.com/object/real-time-ycocg-dxt-compression.html). NVIDIA 개발자 사이트. 2007년 9월.

van Waveren, J.M.P., Castaño, Ignacio. [실시간 표준 맵 DXT 압축](http://developer.download.nvidia.com/whitepapers/2008/real-time-normal-map-dxt-compression.pdf). NVIDIA 개발자 사이트. 2008년 2월.

# 업데이트 기록

2019년 9월 릴리스

# 개인정보처리방침

샘플을 컴파일하고 실행하는 경우 샘플 사용량을 추적할 수 있도록 샘플 실행 파일의 파일 이름이 Microsoft에 전송됩니다. 이 데이터 수집을 옵트아웃하려면 Main.cpp에서 "샘플 사용량 원격 분석"이라는 레이블이 지정된 코드 블록을 제거할 수 있습니다.

일반적인 Microsoft의 개인 정보 정책에 대한 자세한 내용은 [Microsoft 개인정보처리방침](https://privacy.microsoft.com/en-us/privacystatement/)을 참조하세요.


