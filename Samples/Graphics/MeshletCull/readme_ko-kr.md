![](./media/image1.png)

# 메시렛 컬링 샘플

*이 샘플은 Microsoft 게임 개발 키트(2022년 3월) 및 Windows 10(버전 2004) 2020년 5월 업데이트와 호환됩니다.*

# 설명

증폭 셰이더는 메쉬 셰이더 파이프라인에서 메쉬 셰이더 단계 이전의 옵션 스테이지입니다. 증폭 셰이더의 목적은 특정 GPU 작업에 필요한 메쉬 셰이더 스레드 그룹 수를 결정하는 것이며, 선택적으로 데이터의 페이로드를 디스패치된 MS 하위 스레드 그룹에 전달하는 것입니다. 이 셰이더는 워크로드가 파이프라인의 메시 셰이더 단계에 도달하기 전에 워크로드를 줄이거나 확장하는 데 사용할 수 있습니다.

이 샘플은 메시렛별 컬링 메타데이터를 사용하여 카메라에 대해 메시렛을 컬링하기 위해 증폭 셰이더를 활용하는 방법을 보여줍니다. 목표는 메시 셰이더 스레드 그룹이 실행되기 전에 잠재적으로 표시되는 것으로 간주되는 부분에만 필요한 메시 셰이더 스레드 그룹의 수를 최소화하는 것입니다.

![](./media/image3.png)

# 샘플 빌드

Xbox Series X|S 개발 키트를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.Scarlett.x64`(으)로 설정합니다.

적절한 하드웨어 및 Windows 10 릴리스가 설치된 PC를 사용하는 경우 활성 솔루션 플랫폼을 Gaming.Deskop.x64로 설정합니다.

이 샘플은 Xbox One을 지원하지 않습니다.

*GDK 설명서의* __샘플 실행__에서 *자세한 내용을 참조하세요.*

# 샘플 사용

샘플의 초점은 증폭 셰이더 기반 메시렛 컬링 기술을 보여주는 것입니다. 컬링을 켜고 끌 수 있으며, 컬링이 발생하는 카메라는 기본 카메라와 디버그 카메라 간에 전환될 수 있습니다. 디버그 카메라의 위치와 방향은 월드 공간에서 카메라 모델로 표현됩니다. 컬링 카메라의 뷰 프러스텀이 시각화되어 프러스텀 컬링이 발생해야 하는 위치를 보다 쉽게 ​​관찰할 수 있습니다.

샘플에서 제공하는 몇 가지 렌더 모드가 있습니다: 플랫 셰이딩 및 메시렛 시각화. 메시렛 보기 모드 내에서 장면에서 메시렛을 선택하여 메시렛 내 일반형의 너비를 나타내는 경계 구와 원뿔을 시각화할 수 있습니다. 메시렛의 원뿔이 퇴화 원뿔(반구보다 넓음)을 형성하면 원뿔이 렌더링되지 않습니다. 사용자는 또한 몇 가지 다양성을 위해 메시의 6가지 세부 수준 사이를 순환할 수 있습니다.

장면 개체 렌더링에 대한 경과된 GPU 시간과 프레임에서 컬링된 메시렛 수를 나타내는 통계가 화면에 그려집니다.

# 컨트롤

| 동작 | Gamepad | 키보드 |
|---|---|---|
| 카메라 이동 | 왼쪽 엄지스틱/방향 패드 | WASD 또는 화살표 키 |
| 카메라 회전 | 오른쪽 엄지스틱 | LMB + 마우스 누르기 |
| 카메라 초기화 | 오른쪽 엄지스틱(푸시) | 해당 없음 |
| 디버그 카메라 제어 | 왼쪽 어깨 | 왼쪽 시프트 |
| 컬링 토글 | A 버튼 | 탭 |
| 렌더링 모드 변경 | X 버튼 | 스페이스바 |
| 컬링 카메라 전환 | B 버튼 | Q |
| 메시렛 선택 | Y 버튼 | RMB |
| 순환 LOD | 오른쪽 겨드 또는 트리거 | +/- |
| 도움말 메뉴 표시 | 메뉴 버튼 | 해당 없음 |
| 끝내기 | 보기 버튼 | ESC |

# 구현 참고 사항

이 기술은 메시렛 생성 시 컬링 데이터 생성으로 시작합니다. 메시렛 목록이 완료되면 각 메시렛의 개체 공간 경계 구와 일반 원뿔이 계산됩니다. 이 일련의 단계를 수행하는 알고리즘의 샘플 코드는 별도의 샘플인 MeshletConverter를 통해 제공됩니다. 이 데이터는 디스크 상의 메모리와 읽기 대역폭을 절약하기 위해 양자화를 통해 압축됩니다.

일반 원뿔은 메시렛 내 일반형의 *확산*을 나타냅니다. 원뿔은 해당 기본형의 모든 일반형을 둘러싸고 있습니다. 정규화된 부동 소수점 값 4-튜플로 저장됩니다. -- 3D 단위 벡터는 법선 표준 방향을 나타내고 스칼라는 해당 벡터와 가장 다른 삼각형 법선 사이의 내적을 나타냅니다.

컬링 테스트의 이점을 위해 실제 저장된 값은 -cos(*최대 각도* + 90º)입니다. 삼각형이 전체 반구(또는 법선에 대해 90º)에 걸쳐 관찰 가능하기 때문에 90º가 추가되고 역 원뿔이 이 표면 일반형이 뒤를 향하는 뷰 방향 집합을 포함하므로 무효화됩니다. 이렇게 하면 컬링 테스트를 단일 내적 및 부동 소수점 비교로 줄일 수 있습니다.

증폭 셰이더는 각 스레드에서 단일 메시렛을 처리하도록 구성됩니다. 따라서 *n* 메시렛으로 구성된 메시를 렌더링하려면 $\left\lceil \frac{n}{GroupSize} \right\rceil$ 스레드 그룹을 디스패치해야 합니다. 스레드 그룹 전체 작업에 웨이브 내장 함수를 쉽게 사용할 수 있도록 플랫폼의 웨이브 크기와 동일한 스레드 그룹 크기가 선택됩니다. 각 스레드는 해당 메시렛(디스패치 스레드 ID로 인덱싱됨)에 대해 뷰 절두체 및 일반 원추 컬링 테스트를 수행하는 책임이 있습니다. 접두사 sum wave 내장 함수를 사용하면 표시되는 메시렛의 인덱스가 시작된 메시 셰이더 스레드 그룹에 대한 그룹 공유 메모리 조회 테이블로 압축됩니다. 셰이더는 필요한 수의 메시 셰이더 스레드 그룹을 시작하고 그룹 공유 룩업 테이블을 페이로드 데이터로 지정하기 위해 증폭 셰이더 내장 함수 DispatchMesh에 대한 호출로 끝납니다.

# 업데이트 기록

2020년 4월 20일 -- 샘플 만들기.

2020년 4월 28일 - 메시 셰이더 파이프라인 생성에 D3DX12 도우미를 사용하도록 업데이트됨

# 개인정보처리방침

샘플을 컴파일하고 실행하는 경우 샘플 사용량을 추적할 수 있도록 샘플 실행 파일의 파일 이름이 Microsoft에 전송됩니다. 이 데이터 수집을 옵트아웃하려면 Main.cpp에서 "샘플 사용량 원격 분석"이라는 레이블이 지정된 코드 블록을 제거할 수 있습니다.

일반적인 Microsoft의 개인 정보 정책에 대한 자세한 내용은 [Microsoft 개인정보처리방침](https://privacy.microsoft.com/en-us/privacystatement/)을 참조하세요.


