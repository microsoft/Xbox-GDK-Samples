  ![](./media/image1.png)

#   간단한 Meshlet 샘플

*이 샘플은 Microsoft 게임 개발 키트 미리 보기(2019년 11월) 및 PC용
Windows 10 "20H1" 참가자와 호환됩니다.*

# 설명

이 샘플에서는 meshlet 데이터 구조를 소개하고 meshlet을 사용하는 렌더링
예제를 제공합니다. 메시 셰이더 내부에서 기본 형식 선별을 수행하는 방법도
보여 줍니다.

![](./media/image3.png)

# 샘플 빌드

Project Scarlett을 사용하는 경우 활성 솔루션 플랫폼을
Gaming.Xbox.Scarlett.x64로 설정하세요.

적절한 하드웨어 및 Windows 10 릴리스가 있는 PC를 사용하는 경우 활성
솔루션 플랫폼을 Gaming.Desktop.x64로 설정합니다.

이 샘플은 Xbox One을 지원하지 않습니다.

*자세한 내용은 GDK 문서에서* 샘플 실행하기*를 참조하세요.*

# 샘플 사용

카메라 컨트롤 이외에도 사용해볼 수 있는 몇 가지 옵션이 제공됩니다.

기본 meshlet 구조의 시각적 표현은 단추를 클릭하여 토글할 수 있습니다. 각
색상 패치는 최대 크기 128의 meshlet을 나타냅니다.

기본 형식 선별도 토글할 수 있습니다. 선택적으로 기본 형식이 선별되는
보기로 사용할 수 있는 \'debug\' 카메라가 장면에 배치되었습니다. 따라서
사용자는 선별된 기본 형식을 시각화할 수 있습니다. 이 카메라 위치 및
방향은 단추를 누른 상태에서 카메라 컨트롤로 조작할 수 있습니다.

# 컨트롤

| 작업                         |  게임패드         |  키보드            |
|------------------------------|------------------|-------------------|
| 보기 벡터를 따라 카메라 회전/변환 |  왼쪽 썸스틱  |  마우스 휠 |
| 카메라 궤도 조작  |  오른쪽 썸스틱  |  LMB + 마우스 누르기            |
| 카메라 이동  |  D-패드  |  WASD 또는 화살표 키                |
| 카메라 초기화  |  오른쪽 썸스틱(푸시) |  \- |
| Meshlet 시각화 토글          |  X                |  스페이스바        |
| 기본 형식 선별 토글          |  A                |  탭                |
| 카메라 선별 디버깅 토글      |  B                |  Q                 |
| 카메라 컨트롤 디버깅(길게 누르기) |  오른쪽 숄더  |  왼쪽 Shift |
| 메시 LOD 순환  |  왼쪽/오른쪽 트리거 |  +/- 키 |
| 종료                         |  보기 단추        |  Esc               |

# 구현 참고 사항

**Meshlet**은 더 큰 메시의 고정 크기 기본 형식 청크라고 볼 수 있습니다.
Meshlet 구조체에 대해 Meshlet 크기가 선택되고, 전체 메시가 처리될 때까지
기본 형식 및 정점이 meshlet으로 압축됩니다. 이런 방식으로 메시 meshlet
배열이 됩니다.

실제 정점 데이터는 이 프로세스에서 변경되지 않지만 인덱스 버퍼는
*meshlet 목록*, *고유 정점 인덱스 목록* 및 *기본 형식 목록*의 새로운 세
가지 버퍼로 대체됩니다. *meshlet 목록*의 요소는 다른 두 구조체에 대한
단순한 오프셋 및 개수입니다. 이 목록은 각 meshlet에 있는 정점 및 기본
형식을 정의합니다. *고유 정점 인덱스 목록*에는 각 meshlet에 대해 중복
제거된 정점 인덱스의 청크가 포함됩니다. 이러한 청크는 정점 버퍼로 직접
인덱싱하는 데 사용됩니다. *기본 형식 목록*은 각 meshlet의 기본 형식
청크를 정의합니다. 이 목록의 항목은 고유한 정점 인덱스 목록의
인덱스입니다. 각 기본 형식 인덱스는 해당 범위를 8비트로만 줄이는
meshlet의 고유한 정점 인덱스 하위 범위에 대해 로컬입니다.

이 구조체는 메시 셰이더의 고정 크기 스레드 그룹에 매우 잘 매핑되며, 각
meshlet은 단일 스레드 그룹에 매핑될 수 있습니다. 각 meshlet의 최대
크기는 고정되어 있으므로 각 스레드가 담당하는 작업과 적절히 상호
연관됩니다. 이 방식은 셰이더 BasicMeshletMS.hlsl의 기준이 되며, 구현
전체에서 매우 간단합니다.

**기본 형식 선별**은 몇 가지 선별 테스트를 통해 기본 형식별 뷰포트
관련성을 확인하는 프로세스입니다. 메시 셰이더가 해당 출력 수를 동적으로
지정하므로 제출에서 간단히 생략하면 기본 형식이 무시됩니다. 메시 셰이더
기반 기본 형식 선별을 위한 기본 워크플로는 다음 단계로 진행됩니다.

1.  Meshlet 정점을 선별 공간(일반적으로 뷰, 같은 유형 또는 NDC)으로
    변환합니다.

2.  변환된 정점에서 기본 형식 빌드 및 선별 테스트 수행

3.  정상 작동 기본 형식에 표시 정상 작동 정점에 표시

4.  **압축을 통해 정점 및 기본 형식의 최종 출력 인덱스 결정**

5.  다시 매핑된 정점 인덱스에 기본 형식 인덱스 다시 매핑

6.  평소처럼 내보내기

**압축**은 관련 및 비관련 작업 항목(선별 및 비선별)을 모두 포함하는 덴스
목록으로 인덱싱되는 스파스 목록을 생성하는 알고리즘입니다. 이 목록은
조회 테이블로 사용할 인덱스 목록 형태로 표시됩니다. 스레드 그룹
컨텍스트에서, 이 기능을 사용하면 최하위 ID 스레드가 모든 관련 작업
항목에 직접 액세스할 수 있습니다. 이 프로세스는 그룹 공유 메모리 및 그룹
동기화 지점을 사용하여 처리되는 웨이브 간 통신의 필요성 때문에 다소
복잡해 집니다.

# 업데이트 기록

2019년 10월 31일 -- 샘플 만들기

2020년 2월 24일 - LOD 순환 및 카메라 보기 절두체 시각화 디버그를 추가함

# 개인정보처리방침

샘플을 컴파일하고 실행할 때 샘플의 사용을 추적하는 데 도움이 되도록 샘플
실행 파일의 파일 이름이 Microsoft에 전송됩니다. 이 데이터 수집을
옵트아웃하려면 Main.cpp에서 \"샘플 사용 원격 분석\"이라고 레이블이
지정된 코드 블록을 제거할 수 있습니다.

Microsoft의 일반 개인정보취급방침에 대한 자세한 내용은 [Microsoft
개인정보처리방침](https://privacy.microsoft.com/en-us/privacystatement/)을
참조하세요.
