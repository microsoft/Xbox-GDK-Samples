![](./media/image1.png)

# 간단한 메시렛 샘플

*이 샘플은 Microsoft 게임 개발 키트(2022년 3월) 및 Windows 10(버전 2004) 2020년 5월 업데이트와 호환됩니다.*

# 설명

이 샘플에서는 메시렛 데이터 구조를 소개하고 메시렛을 사용하여 렌더링하는 예제를 제공합니다. 또한 메시 셰이더 내부에서 기본형 컬링을 수행하는 방법도 보여줍니다.

![](./media/image3.png)

# 샘플 빌드

Xbox Series X|S를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.Scarlett.x64`(으)로 설정합니다.

적절한 하드웨어 및 Windows 10 릴리스가 설치된 PC를 사용하는 경우 활성 솔루션 플랫폼을 Gaming.Deskop.x64로 설정합니다.

이 샘플은 Xbox One을 지원하지 않습니다.

*GDK 설명서의* __샘플 실행__에서 *자세한 내용을 참조하세요.*

# 샘플 사용

카메라 컨트롤 외에도 사용할 수 있는 몇 가지 옵션이 노출되었습니다.

기본 메시렛 구조체의 시각적 표현은 단추 클릭으로 전환할 수 있습니다. 색이 지정된 각 패치는 최대 크기 128의 메시렛을 나타냅니다.

프리미티브 컬링은 필요에 따라 전환할 수도 있습니다. '디버그' 카메라가 장면에 배치되었으며, 선택적으로 프리미티브 요소가 선별되는 보기로 사용될 수 있습니다. 이렇게 하면 사용자가 컬링된 프리미티브 형식을 시각화할 수 있습니다. 이 카메라의 위치 및 방향은 단추를 누르고 카메라 컨트롤을 조작하여 조작할 수 있습니다.

# 컨트롤

| 동작 | Gamepad | 키보드 |
|---|---|---|
| 보기 벡터를 따라 카메라 회전/변환 | 왼쪽 엄지스틱 | 마우스 휠 |
| 궤도 카메라 | 오른쪽 엄지스틱 | LMB + 마우스 누르기 |
| 카메라 이동 | 방향 패드 | WASD 또는 화살표 키 |
| 카메라 다시 설정 | 오른쪽 엄지스틱(푸시) | \- |
| 메시렛 시각화 토글 | X | 스페이스바 |
| 프리미티브 컬링 토글 | A | 탭 |
| 디버그 카메라 컬링 토글 | B | Q |
| 카메라 컨트롤 디버그(보류) | 오른쪽 어깨 | 왼쪽 시프트 |
| 주기 메시 LOD | 왼쪽/오른쪽 트리거 | 더하기/빼기 키 |
| 끝내기 | 보기 버튼 | ESC |

# 구현 참고 사항

**메쉬렛**은 말 그대로 더 큰 메시의 고정된 크기의 프리미티브 청크입니다. 메시렛 구조에 대해 최대 크기를 선택한 다음, 전체 메시가 처리될 때까지 프리미티브 형식 및 꼭짓점이 메시렛으로 압축됩니다. 이러한 방식으로 메시렛 배열을 메시합니다.

실제 꼭짓점 데이터는 이 프로세스에서 변경되지 않지만 인덱스 버퍼는 *메시렛 목록*, *고유한 꼭짓점 인덱스 목록* 및 *프리미티브 목록*이라는 세 개의 새 버퍼로 대체됩니다. *메시렛 목록*의 요소는 간단한 오프셋이며 다른 두 구조로 계산됩니다. 이는 각 메시렛에 있는 꼭짓점과 기본 형식을 정의합니다. *고유한 꼭짓점 인덱스 목록*에는 각 메시렛에 대해 중복 제거된 꼭짓점 인덱스 청크가 포함되어 있습니다. 이러한 인덱스는 꼭짓점 버퍼에 직접 인덱싱하는 데 사용됩니다. *프리미티브 목록*은 각 메쉬릿에 대한 프리미티브 청크를 정의합니다. 이 목록의 항목은 고유한 꼭짓점 인덱스 목록의 인덱스입니다. 각 프리미티브 인덱스는 메시렛의 고유한 꼭짓점 인덱스 하위 범위에 로컬로 지정되어 해당 범위를 8비트로만 줄입니다.

이 구조는 메시 셰이더의 고정 크기 스레드 그룹에 매우 잘 매핑됩니다. 각 메시렛을 단일 스레드 그룹에 매핑할 수 있습니다. 각 메시렛의 최대 크기는 고정되어 있으므로 각 스레드가 담당하는 작업과 상관 관계가 큽니다. 이는 셰이더 BasicMeshletMS.hlsl의 기초이며 구현 측면에서 매우 간단합니다.

**프리미티브 컬링**은 여러 컬링 테스트에 대한 기본 형식별 뷰포트 관련성을 결정하는 프로세스입니다. 메시 셰이더는 출력 수를 동적으로 지정하므로 프리미티브 형식을 삭제하는 작업은 단순히 제출에서 생략하여 수행됩니다. 메시 셰이더 기반 프리미티브 컬링에 대한 기본 워크플로는 다음 단계입니다.

1. 메시렛 꼭짓점을 컬링 공간(일반적으로 보기, 동종 또는 NDC)으로 변환합니다.

2. 변환된 꼭짓점에서 프리미티브 형식 빌드 및 컬링 테스트 수행

3. 남은 프리미티브 요소 표시가 남아 있는 꼭짓점을 표시합니다.

4. **압축**을 통해 꼭짓점 및 기본형의 최종 출력 인덱스 확인

5. 다시 매핑된 꼭짓점 인덱스에 프리미티브 인덱스 다시 매핑

6. 평소대로 내보내기

**압축**은 관련되지 않은 작업 항목(컬링 및 풀링되지 않음)을 모두 포함하는 조밀한 목록으로 인덱싱되는 스파스 목록을 생성하는 알고리즘입니다. 이 목록은 조회 테이블로 사용할 인덱스 목록의 형식을 사용합니다. 스레드 그룹 컨텍스트에서 이를 통해 가장 낮은 ID 스레드가 모든 관련 작업 항목에 직접 액세스할 수 있습니다. 이 프로세스는 그룹 공유 메모리 및 그룹 동기화 지점을 사용하여 처리되는 웨이브 간 통신의 필요성으로 인해 다소 복잡합니다.

# 알려진 문제

최적화(`-Od`)를 비활성화하면 PC에서 `CullMeshletMS.hlsl`이(가) 중단됩니다. 이는 Windows SDK(10.0.19041)와 함께 제공되는 버전의 셰이더 컴파일러(dxc.exe) 버그 때문입니다. 이 문제는 이후 [GitHub](https://github.com/microsoft/DirectXShaderCompiler)에서 사용할 수 있는 최신 릴리스에서 해결되었습니다.

# 업데이트 기록

2019년 10월 31일 -- 샘플 만들기.

2020년 2월 24일 -- LOD 순환 및 디버그 카메라 뷰 frustum 시각화가 추가되었습니다.

2020년 4월 28일 - 메시 셰이더 파이프라인 생성에 D3DX12 도우미를 사용하도록 업데이트됨

2021년 9월 2일 -- Windows SDK dxc를 사용하여 최적화를 사용하지 않도록 설정하면 PC에서 손상되는 것에 대한 참고 사항이 추가됨

# 개인정보처리방침

샘플을 컴파일하고 실행하는 경우 샘플 사용량을 추적할 수 있도록 샘플 실행 파일의 파일 이름이 Microsoft에 전송됩니다. 이 데이터 수집을 옵트아웃하려면 Main.cpp에서 "샘플 사용량 원격 분석"이라는 레이블이 지정된 코드 블록을 제거할 수 있습니다.

일반적인 Microsoft의 개인 정보 정책에 대한 자세한 내용은 [Microsoft 개인정보처리방침](https://privacy.microsoft.com/en-us/privacystatement/)을 참조하세요.


