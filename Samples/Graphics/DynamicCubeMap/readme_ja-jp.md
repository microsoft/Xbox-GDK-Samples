![](./media/image1.png)

# DynamicCubeMap Sample

*このサンプルは、Microsoft Game Development Kit と互換性があります (2022 年 3 月)*

# 説明

このサンプルでは、ジオメトリ シェーダー、インスタンス化、メッシュ シェーダーなど、さまざまなレンダリング メソッドを使用して、実行時にキューブマップにレンダリングする方法を示します。

# サンプルのビルド

Xbox One 開発キットを使用している場合は、アクティブなソリューション プラットフォームを `Gaming.Xbox.XboxOne.x64` に設定します。

Xbox Series X|S を使用している場合は、アクティブなソリューション プラットフォームを `Gaming.Xbox.Scarlett.x64` に設定します。

*詳細については、* *GDK ドキュメント*の「__サンプルの実行__」を参照してください。

# サンプルの使用方法

左右のサムスティックを使用して、シーン内でカメラを動かすことができます。 方向パッドで反射球を上下に動かすことができます。 左右の方向パッド ボタンは、レンダリング モードを順番に切り替えます。 [Y] ボタンをクリックすると、非同期計算のオンとオフが切り替わります。

![](./media/image2.jpeg)

# Controls

| 操作 | ゲームパッド |
|---|---|
| 非同期コンピューティングのオン/オフを切り替える | Y button |
| 球を上下に動かす | 方向パッドの上下 |
| レンダリング モードを変更する | 方向パッド (左/右) |
| カメラを移動する | 左サムスティック |
| カメラを回転させる | 右サムスティック |

# 実装メモ

このサンプルでは、実行時にシーン ジオメトリをキューブマップに動的にレンダリングする 4 つの方法を示します。

1. ループ: シーン ジオメトリの描画呼び出しは、適切な変換行列を使用して、各反復レンダリングをキューブマップの異なる顔に対してループで送信します。

2. ジオメトリ シェーダー: ジオメトリは 1 回送信され、ジオメトリ シェーダー内の各キューブマップ面に増幅されます。 ジオメトリ シェーダーは、各キューブマップの面をループし、SV_RenderTargetArrayIndex を使用して、変換されたジオメトリを適切なキューブマップの顔に送信します。

3. インスタンス化: ジオメトリは、インスタンス数 6 を使用して 1 回送信されます。 頂点シェーダーでは、SV_InstanceID を使用して適切な変換行列を選択し、SV_RenderTargetArrayIndex を使用して対応するキューブマップの顔にジオメトリを割り当てます。

4. メッシュ シェーダー (Scarlett のみ): ジオメトリは 1 回送信され、増幅シェーダーを使用して各キューブマップフェイスのジオメトリをレプリケートします。 増幅シェーダーもメッシュレット レベルでカリングを実行するため、特定のキューブマップの顔に表示されるメッシュレットのみがメッシュ シェーダーに送信されます。 メッシュ シェーダーは、ジオメトリを変換し、SV_RenderTargetArrayIndex を使用して適切なキューブマップの顔に送信します。

ジオメトリをキューブマップにレンダリングした後、サンプルは計算シェーダーを使用してキューブマップのミップマップ チェーンを作成します。 非同期計算モードを使用する場合、ミップ生成は、キューブマップを使用しないシーンの部分のレンダリングと並行して非同期計算キューで行われます。

キューブマップ ミップを生成した後、サンプルはキューブマップ テクスチャからサンプリングする反射球をレンダリングします。

# 既知の問題

一部のジオメトリが消えるアンプリフィケーション シェーダーを含む Scarlett ドライバーのバグがあります。

ジオメトリ シェーダーに関する Scarlett ドライバーのバグにより、いくつかの小さな三角形が欠落しています。

これらのドライバーのバグは March 2023 GDK で修正されているため、メッシュ シェーダーとジオメトリ シェーダーの実装は以前の GDK バージョンで無効になっています。

# 更新履歴

サンプルの元のバージョンは、XSF ベースのフレームワークを使用して記述されました。 2023 年 1 月に ATG サンプル テンプレートを使用するように書き換えられ、レンダリング メソッドとしてメッシュ シェーダーのサポートも追加されました。

# プライバシーに関する声明

サンプルをコンパイルして実行する場合、サンプルの使用状況を追跡するために、サンプルの実行可能ファイルのファイル名が Microsoft に送信されます。 このデータ コレクションからオプトアウトするには、Main.cpp の "サンプル使用状況テレメトリ" というラベルの付いたコードのブロックを削除します。

Microsoft のプライバシー ポリシー全般の詳細については、「[Microsoft のプライバシーに関する声明](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。


