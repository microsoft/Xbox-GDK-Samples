![](./media/image1.png)

# DXR 三角形示例

*此示例与 Microsoft 游戏开发工具包（2022 年 3 月）和 Windows 10 （版本 1903）2019 年 5 月更新兼容*

# 说明

此示例演示 DXR API 的基本用法。 它创建一个光线跟踪管道状态对象 (RTPSO)、着色器表和顶层/底层加速结构。 它还演示了如何使用光线生成、最接近命中、任意命中和未命中着色器以及底层加速度结构的实例化。

![](./media/image3.png)

# 生成示例

如果使用 Project Scarlett，请将活动解决方案平台设置为 `Gaming.Xbox.Scarlett.x64`。

如果使用具有适当硬件和 Windows 10 版本的个人电脑，请将活动解决方案平台设置为 `Gaming.Deskop.x64`。

此示例不支持 Xbox One。

*有关更多信息，请参阅*&nbsp;__运行示例__（位于 *GDK&nbsp;文档）中。*

# 使用示例

采用经典&ldquo;SimpleTriangle&rdquo;并将其带入光线追踪时代，这是滑过屏幕的可配置数量的三角形。 通过在键盘/游戏板上按 A，可以开启和停止任意命中着色器的使用 - 穿过每个三角形打一个孔以显示其后面的三角形。

# 控件

| 操作 | 游戏板 | 键盘 |
|---|---|---|
| 切换任意命中着色器 | A | A |
| 增加三角形的 \# | 方向键（向上） | \+ |
| 减少三角形的 \# | 方向键（向下） | \- |
| 增加孔的大小 | 右扳机键 | W |
| 减少孔的大小 | 左扳机键 | S |
| 退出 | &ldquo;视图&rdquo;按钮 | 退出 |

# 实现说明

此示例首先使用&ldquo;CreateStateObject&rdquo;API 创建光线跟踪管道状态对象 (RTPSO)。 RTPSO 包含一个命中组，由最接近命中着色器和任意命中着色器组成。 还指定了其他配置属性，例如递归级别和光线有效负载大小。

底层加速结构 (BLAS) 由单个三角形组成，根据当前选定的三角形数量，在顶层加速结构 (TLAS) 中实例化 1 到 10 次。 为每个实例提供了其在场景中的位置和大小。 默认情况下，每个帧都会构建 TLAS 和 BLAS，以便它们在 PIX 捕获中显示（如果希望采用）。 但是，在发货标题中，通常只需重新构建每个帧的 TLAS 并长时间（可能永远）重复使用 BLAS。

光线生成着色器会沿 Z 轴设置一个简单的正交投影外观，并在 DispatchRays 调用中启动的每个线程触发一条光线。

为错过每个三角形并将黑色写入 UAV 的每条光线调用未命中着色器（这代替了在 DispatchRays 调用之前将 UAV 预先清除为黑色）。

最接近命中着色器会计算重心坐标，并将这些坐标用作像素的最终颜色。

任意命中着色器会计算到重心坐标空间中三角形中心 (0.333, 0.333, 0.333) 的简单距离，并请求在距离小于某个容差时忽略命中。 然后，允许光线穿过三角形，并可能沿 z 轴进一步命中其他三角形。

# 更新历史记录

11/1/2019 &ndash; 创建示例。

# 隐私声明

在编译和运行示例时，将向 Microsoft 发送示例可执行文件的文件名以帮助跟踪示例使用情况。 若要选择退出此数据收集，你可以删除 Main.cpp 中标记为&ldquo;示例使用遥测&rdquo;的代码块。

有关 Microsoft 的一般隐私策略的详细信息，请参阅 [Microsoft 隐私声明](https://privacy.microsoft.com/en-us/privacystatement/)。


