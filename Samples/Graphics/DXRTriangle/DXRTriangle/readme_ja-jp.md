  ![](./media/image1.png)

#   DXR 三角形のサンプル

*\* このサンプルは、2019 年 11月の Scarlett GXDK と互換性があります。*

# 説明

このサンプルでは、DXR API
の基本的な使用方法を示します。レイトレーシングパイプライン状態オブジェクト
(RTPSO)、シェーダー テーブル、Top-Level / Bottom-Level Acceleration
Structure を作成します。また、Ray Generation、Closest-Hit、Any-Hit、Miss
シェーダー、Bottom-Level Acceleration Structure
のインスタンス作成の使用についても説明します。

![](./media/image3.png)

# サンプルの作成

このサンプルは、Project Scarlett のみをサポートしています。

*詳細については、GDK ドキュメントの*
「サンプルの実行」*を参照してください。*

# サンプルの使用

標準的な 'SimpleTriangle'
を作成して、それをレイトレーシング時代に設定すると、画面全体に、構成可能な数の三角形がスライドされます。キーボードまたはゲームパッドの
A ボタン押すと、Any-Hit
シェーダーのオンとオフを切り替えることができます。すると各三角形に穴があき、背後の三角形が見えるようになります。

# コントロール​​

| 動作                         |  ゲームパッド     |  キーボード        |
|------------------------------|------------------|-------------------|
| Any-Hit Shader を切り替える  |  A                |  A                 |
| 三角形の数を増加する         |  方向パッド上     |  \+                |
| 三角形の数を減少する         |  方向パッド下     |  \-                |
| 穴のサイズを拡大する         |  右トリガー       |  W                 |
| 穴のサイズを縮小する         |  左トリガー       |  S                 |
| 終了する                     |  表示ボタン       |  Escape キー       |

# 実装に関する注意事項

このサンプルでは、まず 'CreateStateObject' API
を使用してレイトレーシング パイプライン状態オブジェクト (RTPSO)
を作成します。RTPSO には、Closest-Hit Shader と Any-Hit Shader
で構成された Hit-Group が 1 つ含まれています。再帰レベルやレイペイロード
サイズなど、その他の構成プロパティも指定されます。

Bottom-Level Acceleration Structure (BLAS)
は、1つの三角形から構成されており、現在選択されている三角形数に応じて、1
～ 10 回の間でTop-Level Acceleration Structure (TLAS)
にインスタンス化されます。各インスタンスには、シーンの固有の位置とサイズが割り当てられます。既定では、TLAS
と BLAS はどちらも、取得したい PIX
キャプチャに表示されるように各フレームで構築されます。ただし、出荷用のタイトルでは、TLAS
の各フレームのみを再構築し、BLAS は (潜在的に永久の)
長期間に再利用します。

Ray Generation シェーダーは、Z
軸に沿って単純な正射投影法を設定し、DispatchRays
呼び出しで開始されるスレッドごとに 1 つの光線を投射します。

Miss
シェーダーは、すべての三角形が欠落した各光線に対して対して呼び出され、黒を
UAV に書き込みます (これは DispatchRays 呼び出しの前に UAV
を黒に事前クリアする代わりです)。

Closest-Hit
シェーダーは、重心座標を計算し、それをピクセルの最終色として使用します。

Any-Hit シェーダーは、重心座標空間の三角形 (0.333、0.333、0.333)
の中心に対する単純な距離を計算し、その距離が一定の許容値を下回った場合、ヒットを無視するように要求します。これにより、光線は三角形を通過するため、Z
軸に沿って他の三角形をヒットする可能性があります。

# 更新履歴

2019 年 11 月 1 日 -- サンプルの作成。

# プライバシーに関する声明

サンプルをコンパイルして実行すると、サンプルの使用状況を追跡するため、サンプル実行可能ファイルのファイル名が
Microsoft に送信されます。このデータ収集を無効にするには、「Sample Usage
Telemetry」とラベル付けされた Main.cpp
内のコードのブロックを削除します。

Microsoft のプライバシー方針の詳細については、「[Microsoft プライバシー
ステートメント](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。
