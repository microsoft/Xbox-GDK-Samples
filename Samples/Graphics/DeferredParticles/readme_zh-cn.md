  ![](./media/image1.png)

#   延迟粒子

*此示例与 Microsoft 游戏开发工具包预览版（2019 年 11 月）兼容*

# 说明

此 D3D12
示例展现了一种以向前或延迟方式呈现亮起的烟雾粒子的方法。在使用延迟路径时，每一粒子的"程度"、"不透明度"和"颜色"会累积到延迟缓冲区中。结果是粒子会在最终传递中亮起并合并到原始场景中。

![](./media/image3.jpeg)

# 构建示例

如果使用 Xbox One devkit，请将活动解决方案平台设置为
Gaming.Xbox.XboxOne.x64。

如果使用 Project Scarlett，请将活动解决方案平台设置为
Gaming.Xbox.Scarlett.x64。

*有关详细信息，请参阅 GDK 文档中的"*运行示例*"。*

# 使用示例

此示例使用以下控制。

| 操作                            |  游戏手柄                           |
|---------------------------------|------------------------------------|
| 退出示例                        |  选择                               |
| 移动镜头                        |  左/右摇杆                          |
| 切换向前/推迟                   |  "A"按钮                            |
| 暂停模拟                        |  "X"按钮                            |

# 

# 

# 实现说明

粒子模拟本身是针对 CPU 执行的。生成的粒子位置会被复制到每帧用于呈现的
GPU 内存中。内存是从提交到上传堆的临时 D3D12 资源内子分配的，此操作是
CPU 可写、GPU 可读的操作。然后会使用 D3D12_VERTEX_BUFFER_VIEW 和
ID3D12GraphicsCommandList::IASetVertexBuffers(...) 将此内存的 GPU
虚拟地址直接作为顶点缓冲区引用。

可以使用两种呈现模式 --
向前和延迟。在向前路径中，粒子是直接呈现到场景中的。在使用延迟路径时，粒子数据会累积到两个延迟缓冲区中
--
一个程度映射和一个不透明度/颜色映射。在完成粒子呈现后，这些延迟缓冲区会用于点亮粒子，然后将它们合并回主场景中。

粒子不仅会由场景光（单向光线）点亮，同时也会被爆炸内的点光源点亮。这些点光源没有方向，因此它们是根据针对距离的二次衰减（而不是方向）来点亮粒子的。

# 更新历史记录

2019 年 4 月 -- 从旧 Xbox 示例框架移植到新模板。

# 隐私声明

在编译和运行示例时，示例可执行文件的文件名将发送给
Microsoft，用于帮助跟踪示例使用情况。要选择退出此数据收集，你可以删除
Main.cpp 中标记为"示例使用遥测"的代码块。

有关 Microsoft 的一般隐私政策的详细信息，请参阅 [Microsoft
隐私声明](https://privacy.microsoft.com/en-us/privacystatement/)。
