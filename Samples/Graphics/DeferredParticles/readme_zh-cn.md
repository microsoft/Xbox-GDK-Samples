![](./media/image1.png)

# 延迟的颗粒

*此示例可用于 Microsoft 游戏开发工具包（2022 年 3 月）*

# 说明

此 DirectX 12 示例演示一种用于以正向或延迟方式呈现点燃烟雾粒子的方法。 使用延迟路径时，每个粒子的常态、不透明度和颜色将累积到延迟缓冲区中。 结果是点燃，并以合成形式显示在最终处理中的原始场景中。

![](./media/image2.jpeg)

# 生成示例

如果使用 Xbox One 开发工具包，请将活动解决方案平台设置为 `Gaming.Xbox.XboxOne.x64`。

如果使用 Xbox Series X|S 开发工具包，请将活动解决方案平台设置为 `Gaming.Xbox.Scarlett.x64`。

*有关详细信息，请参阅* *GDK 文档*中的__运行示例__。&nbsp;

# 使用示例

此示例使用以下控件。

| 操作 | 游戏板 |
|---|---|
| 退出示例 | 选择 |
| 移动相机 | 左/右摇杆 |
| 向前/延迟切换 | &ldquo;A&rdquo;按钮 |
| 暂停模拟 | &ldquo;X&rdquo;按钮 |

# 实现说明

粒子模拟本身在 CPU 上执行。 生成的粒子位置将复制到每个帧的 GPU 内存中，以便进行呈现。 内存是从提交到上传堆的暂时性 D3D12 资源中子分配的，该资源为 CPU 可写、GPU 可读。 然后，使用 `D3D12_VERTEX_BUFFER_VIEW` 和 `ID3D12GraphicsCommandList::IASetVertexBuffers(...)` 直接引用此内存的 GPU 虚拟地址作为顶点缓冲区。

有两种呈现模式可用 - 向前和延迟。 在前向路径中，粒子直接呈现到场景中。 遵循延迟路径时，粒子数据会累积到两个延迟缓冲区中 -- 一个普通映射和一个不透明度/颜色映射。 粒子呈现完成后，这些延迟的缓冲区用于点亮粒子并将其组合回主场景。

粒子不仅被场景光（单向光）点亮，而且由爆炸本身内部的点灯点亮。 这些点光为非定向的，因此它们对粒子的照明贡献基于距离的二次下降，而不是方向。

# 更新历史记录

2019 年 4 月 -- 从旧版 Xbox 示例框架移植到新模板。

# 隐私声明

在编译和运行示例时，将向 Microsoft 发送示例可执行文件的文件名以帮助跟踪示例使用情况。 若要选择退出此数据收集，你可以删除 Main.cpp 中标记为&ldquo;示例使用遥测&rdquo;的代码块。

有关 Microsoft 的一般隐私策略的详细信息，请参阅 [Microsoft 隐私声明](https://privacy.microsoft.com/en-us/privacystatement/)。


