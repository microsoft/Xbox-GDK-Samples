# HDR 디스플레이 매핑 샘플

*이 샘플은 Microsoft 게임 개발 키트(2022년 3월)와 호환됩니다.*

# 설명

이 샘플은 HDR 지원 TV에서 HDR 장면을 렌더링할 때에도 약간의 톤 매핑, 일명 "HDR 디스플레이 매핑"이 필요함을 보여줍니다. HDR 디스플레이 매핑은 HDR TV가 표시할 수 있는 것보다 더 밝은 값을 TV의 가능한 범위 이상의 밝기로 매핑하여 장면의 밝은 영역에 있는 디테일이 잘리지 않습니다. 백서 "[HDR 디스플레이 매핑](http://aka.ms/hdr-display-mapping)"을 참조하세요.

![샘플 스크린샷](./media/image1.png)

# 샘플 빌드

Xbox One 개발 키트를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.XboxOne.x64`(으)로 설정합니다.

Xbox Series X|S를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.Scarlett.x64`(으)로 설정합니다.

*자세한 내용은* *GDK 설명서의* __샘플 실행을__ 참조하세요.&nbsp;

# 샘플 사용

이 샘플에서는 다음 컨트롤을 사용합니다.

| 동작 | Gamepad |
|---|---|
| 다른 매핑 메서드 간 전환 | A button |
| HDR 및 SDR 렌더링 간 전환 | B 버튼 |
| TV의 최대 밝기보다 밝은 값 강조 표시 | Y 버튼 |
| 그래프/곡선 표시 설정/해제 | X 버튼 |
| 부드러운 리어버를 매핑하는 HDR 디스플레이 조정 | D-패드 왼쪽/오른쪽 |
| 장면의 전체 밝기 조정 | 방향 패드 위/아래 |

# 구현 참고 사항

SDR TV의 HDR 장면에서 밝은 값을 시각화하려면 HDR-SDR 톤 매핑이 필요합니다. Reinhard 및 Filmic과 같은 이러한 톤 매핑 연산자는 다음과 같은 방식으로 값을 매핑하므로 흰색보다 밝은 값이 잘리지 않습니다.

```
[Black..MaxBrightnessOfHDRScene] = [Black..White]
```


이 샘플은 HDR 지원 TV에서 HDR 장면을 렌더링할 때에도 약간의 톤 매핑이 필요함을 보여줍니다. 이를 "HDR 디스플레이 매핑"으로 지칭합니다. HDR 디스플레이 매핑은 최대 TV 밝기보다 밝은 값이 잘리지 않도록 다음과 같은 방식으로 값을 매핑합니다.

```
[Black..White] = [Black..White]

[White..BrightShoulder] = [White-BrightShoulder]

[BrightShoulder..MaxBrightnessOfHDRScene] = [BrightShoulder..MaxBrightnessOfTV]
```


그 이유는 HDR TV의 최대 밝기 수준이 다르기 때문입니다. 예를 들어 한 TV는 최대 600니트를 출력할 수 있지만 다른 TV는 2,000니트를 출력할 수 있습니다. HDR 장면의 최대 밝기 값이 1500니트인 경우 최대 밝기 2000니트를 출력할 수 있는 TV는 HDR 장면의 모든 값을 표시할 수 있습니다. 그러나 600니트 TV에서 600니트를 초과하는 모든 값은 TV에서 자연스럽게 600니트까지 잘리므로 장면의 밝은 영역에서 모든 세부 정보가 손실됩니다. 실제로 이러한 경우 간단한 HDR-SDR 톤 매핑은 더 많은 세부 정보를 표시하며, 흰색으로, 밝지 않고, 장면의 밝은 영역에서 세부 정보를 표시하여 시각적 품질에 추가하는 것이 매우 중요합니다.

HDR 디스플레이 매핑 구현은 여러 가지 방법으로 수행할 수 있습니다. 이 샘플에서는 샘플의 X 단추를 사용하여 시각화할 수 있는 비선형 ST.2084 값을 사용하여 구현하는 방법을 보여줍니다. 다음 세 가지 지점이 정의됩니다.

1. **P0**, 부드러운 겨드러기의 시작(예: 500니트)

2. **P1**, TV의 최대 밝기(예: 1000니트)

3. **P2**, HDR 장면의 최대 밝기(예: 2000니트)

간단한 베지어 곡선은 P0, P1 및 P2를 사용하여 적합합니다.

이 방법은 밝기를 더 자세히 손상하기 때문에 세부 정보를 위해 얼마나 많은 밝기가 손상되는지 선택할 수 있는 것이 좋습니다. 따라서 샘플에는 세 가지 모드가 있습니다.

- **없음** -- 디스플레이 매핑이 없습니다. 원시 HDR 값을 TV에 출력하기만 하면 합니다. 매우 밝은 영역에서 클리핑되는 것을 확인합니다.

- **클리핑 없음** -- 장면의 최대 밝기를 TV의 최대 밝기까지 매핑합니다. 모든 세부 정보를 볼 수 있지만 이미지는 밝지 않습니다.

- **일부 클리핑** -- 장면의 최대 밝기를 TV의 최대 밝기(예: 200니트)보다 약간 더 밝은 부분에 매핑합니다. 이렇게 하면 약간의 클리핑만으로 세부 정보를 볼 수 있으므로 밝기 중 일부를 다시 추가합니다.

![샘플 스크린샷](./media/image2.png)

또한 샘플에는 잘린(빨간색) 장면의 밝은 값과 TV의 최대 밝기(자주색)에 있는 값을 강조 표시하는 유용한 시각화가 있습니다.

|  |
|---|---|
| ![샘플 스크린샷](./media/image3.jpeg) | 톤 매핑 없이 SDR TV에 표시되는 이미지입니다. 자주색 픽셀은 1.0f에서 렌더링된 모든 값을 나타냅니다. |
| ![샘플 스크린샷](./media/image4.jpeg) | HDR 디스플레이 매핑 없이 HDR TV에 표시되는 이미지입니다. 빨간색 픽셀은 TV가 표시할 수 있는 값보다 밝은 장면의 모든 값(즉, 잘리는 밝은 값)을 나타냅니다. |
| ![샘플 스크린샷](./media/image5.jpeg) | HDR 디스플레이 매핑을 사용하여 HDR TV에 표시되는 이미지입니다. 이제 밝은 값이 TV의 최대 밝기를 초과하지 않는 방식으로 매핑되었음을 나타내는 빨간색 픽셀이 더 이상 없습니다. 자주색 픽셀은 TV의 최대 밝기에서 TV보다 밝지는 않은 값을 나타냅니다. |
| ![샘플 스크린샷](./media/image6.jpeg) | 위와 동일하지만 이제 약간의 클리핑을 허용하여 세부 정보와 밝기 사이에서 적절한 절충점을 찾았습니다. |

# 알려진 문제

없음

# 업데이트 기록

2016년 3월 초기 릴리스

DirectX 12 2017년 6월 12일 업데이트됨

# 개인정보처리방침

샘플을 컴파일하고 실행하는 경우 샘플 사용량을 추적할 수 있도록 샘플 실행 파일의 파일 이름이 Microsoft에 전송됩니다. 이 데이터 수집을 옵트아웃하려면 Main.cpp에서 "샘플 사용량 원격 분석"이라는 레이블이 지정된 코드 블록을 제거할 수 있습니다.

일반적인 Microsoft의 개인 정보 정책에 대한 자세한 내용은 [Microsoft 개인정보처리방침](https://privacy.microsoft.com/en-us/privacystatement/)을 참조하세요.


