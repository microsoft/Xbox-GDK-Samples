# HDR 정밀도 샘플

*이 샘플은 Microsoft 게임 개발 키트(2022년 3월)와 호환됩니다.*

# 설명

이 샘플은 다음에서 HDR을 렌더링하는 동안 다양한 형식과 색 공간을 사용할 때 정밀도와 GPU 성능이 어떻게 영향을 받는지 보여줍니다.
플래그는 일부 GPU 처리를 디스플레이 하드웨어로 오프로드할 수 있으며 일부 조합은 디스플레이로 이동되는 최종값에서 더 높은 정밀도를 생성합니다. 이 샘플은 HDR 장면을 렌더링하는 동안 999e5 형식을 사용하는 방법도 보여줍니다. ![자동으로 생성된 배경 패턴 설명](./media/image1.jpeg)
| | |
|---|---|
|Xbox Series X|S 콘솔. 예를 들어 스왑 버퍼의 일부 조합|


# 샘플 빌드

사용 가능한 플랫폼은 Gaming.Xbox.Scarlett.x64입니다. *GDK 설명서의* __샘플 실행__에서 *자세한 내용을 알아보세요.*
| | |
|---|---|
|이 샘플은 Xbox Series X|S에 대해서만 작동하므로 유일한 솔루션|


# 컨트롤

| 동작 | Gamepad |
|---|---|
| HDR 장면 렌더링 대상 형식 변경 | A 버튼 |
| 스왑 버퍼 색 공간 변경 | X 버튼 |
| 스왑 버퍼 감마 곡선 변경 | Y 버튼 |
| 램프 밝기 조정 | 방향 패드 |
| 램프/이미지 렌더링 토글 | B 버튼 |
| 다음/이전 이미지 선택 | 왼쪽/오른쪽 겨드년 |
| 끝내기 | 보기 버튼 |

# 구현 참고 사항

**HDR 장면 렌더링**

샘플은 HDR 장면 렌더링을 위해 다음 렌더 대상 형식을 사용할 수 있습니다. 999e5는 Xbox에서 렌더링 대상 형식으로 사용할 수 있습니다.
어둡고 밝은 영역에서 정밀도를 검사하도록 램프 밝기를 조정하는 방향 패드입니다. "A" 버튼을 사용하여 형식 사이를 전환합니다.
| | |
|---|---|
|Xbox One에서와 같은 텍스처 형식이 아닌 X|S 시리즈 콘솔. 사용|

```cpp
DXGI_FORMAT HDRBackBufferFormat[] = { DXGI_FORMAT_R9G9B9E5_SHAREDEXP,
                                      DXGI_FORMAT_R11G11B10_FLOAT,
                                      DXGI_FORMAT_R32G32B32A32_FLOAT };
```


**스왑 버퍼**

색 변환 및 감마 곡선 적용 따라서 HDR 타이틀은 GPU에서 HDR10 변환을 처리하거나 디스플레이 하드웨어에서 무료로 처리하도록 선택할 수 있습니다. **감마 곡선**
| | |
|---|---|
|Xbox Series X|S 콘솔의 디스플레이 하드웨어는 수행할 수 있습니다.|


HDR10을 사용하려면 콘솔에서 ST.2084 감마 곡선으로 인코딩된 이미지를 디스플레이로 보내야 합니다. 타이틀은 셰이더에서, 아마도 마지막 포스트 프로세싱 드로우 호출에서 ST.2084 감마 곡선을 적용할 수 있습니다. 감마 곡선 구현은 LinearToST2084() 함수에서 찾을 수 있습니다. 상당한 양의 ALU 명령이지만 대역폭 비용과 같은 다른 요인이 관련되어 있으므로 셰이더에서 여전히 성능이 충분할 수 있습니다. 셰이더에서 감마 곡선을 구현할 때 스왑 버퍼 형식은 10:10:10:2여야 합니다.

타이틀에서 디스플레이 하드웨어가 해당 변환을 수행하도록 하려면 스왑 버퍼 형식은 999e5여야 하고 셰이더는 정규화된 선형 값을 렌더링해야 합니다. "switch(GammaCurve)" 섹션의 PerpareSwapBuffer.hlsl의 코드를 참조하세요.

Y 버튼을 사용하여 형식 간에 전환합니다.

```cpp
DXGI_FORMAT SwapBufferFormat[] = { DXGI_FORMAT_R9G9B9E5_SHAREDEXP,
                                   DXGI_FORMAT_R10G10B10A2_UNORM };
```


올바른 Present 플래그를 사용하여 그래픽 드라이버에 스왑 버퍼의 내용을 알려야 합니다. 셰이더가 정규화된 선형 값을 출력하는 경우 감마 1.0을 참조하는 DXGI_COLOR_SPACE_RGB_FULL\_**G10**\_NONE\_\* 플래그 중 하나가 필요합니다. 셰이더가 ST.2084 감마 곡선을 출력하는 경우 DXGI_COLOR_SPACE_RGB_FULL\_**G2084**\_NONE\_\* 플래그 중 하나가 필요합니다.

**색상 변환**

HDR10을 사용하려면 콘솔에서 Rec.2020 색 공간에 있는 디스플레이로 이미지를 보내야 합니다. 오늘날 대부분의 타이틀은 Rec.709를 사용하여 마스터링되고 일부는 P3-D65 색 공간으로 확장됩니다. 따라서 색상은 Rec.2020으로 회전해야 합니다. 타이틀은 셰이더에서 해당 색상 회전을 수행하거나 디스플레이 하드웨어에 이를 수행하도록 요청할 수 있습니다. 디스플레이 하드웨어가 변환을 수행해야 하는 경우 제목은 기본 마스터링된 색 공간, 스왑 버퍼에서 렌더링되는 색 공간을 지정해야 합니다.

올바른 Present 플래그를 사용하여 그래픽 드라이버에 스왑 버퍼에 있는 색 공간을 알려야 합니다. 다음 플래그 중 하나를 지정해야 합니다.

```
DXGI_COLOR_SPACE_RGB_FULL_*_NONE_P709
DXGI_COLOR_SPACE_RGB_FULL_*_NONE_D65P3
DXGI_COLOR_SPACE_RGB_FULL_*_NONE_P2020
```

X 버튼을 사용하여 다른 색 공간 사이를 전환합니다.

# 업데이트 기록

2021년 3월 26일 -- 샘플 만들기.

# 개인정보처리방침

샘플을 컴파일하고 실행하는 경우 샘플 사용량을 추적할 수 있도록 샘플 실행 파일의 파일 이름이 Microsoft에 전송됩니다. 이 데이터 수집을 옵트아웃하려면 Main.cpp에서 "샘플 사용량 원격 분석"이라는 레이블이 지정된 코드 블록을 제거할 수 있습니다.

일반적인 Microsoft의 개인 정보 정책에 대한 자세한 내용은 [Microsoft 개인정보처리방침](https://privacy.microsoft.com/en-us/privacystatement/)을 참조하세요.


