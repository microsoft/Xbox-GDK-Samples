  ![](./media/image1.png)![](./media/image3.png)

#   FidelityFX Super Resolution

*このサンプルは Microsoft Game Development Kit (2021 年 4 月)
と互換性があります*

# 説明

AMD FidelityFX Super Resolution (FSR)
は、低解像度の入力からより高い解像度の出力を生成するための、最適化された高品質のソリューションです。これは、高品質のエッジの作成に特に重点を置いた最先端のアルゴリズムのコレクションを使用し、ネイティブ解像度で直接レンダリングするのと比較してパフォーマンスが大幅に向上します。FSR
を使用すると、ハードウェア レイ
トレーシングなどのコストのかかるレンダリング操作に対して
\"実用的なパフォーマンス\" を実現できます。

# このサンプルでは、シーンに対する FSR 効果の実装を示します。ネイティブ レンダリングと比較する設定を変更しながらイメージの画質を検査する、移動可能な拡大鏡があります。

FidelityFX Super Resolution に関する最新情報は、GPUOpen の
<https://gpuopen.com/fsr> にあります。

![](./media/image4.jpeg)

# サンプルのビルド

Windows デスクトップを使用している場合には、アクティブ ソリューション
プラットフォームを Gaming.Desktop.x64 に設定します。

Project Scarlett を使用している場合は、アクティブ ソリューション
プラットフォームを Gaming.Xbox.Scarlett.x64 に設定します。

Xbox One を使用している場合は、アクティブ ソリューション
プラットフォームを Gaming.Xbox.XboxOne.x64 に設定します。

Windows デスクトップを実行する場合は、システムの最新のグラフィックス
ドライバーがインストールされていることを確認します。

*詳細については、GDK
のドキュメントの*「サンプルの実行」*を参照してください。*

# サンプルの使用方法

| 操作                                  |  ゲームパッド                 |
|---------------------------------------|------------------------------|
| ビューの回転                          |  左サムスティック             |
| 拡大鏡の位置                          |  右スティック                 |
| 終了                                  |  ビュー ボタン                |
| FSR オン/オフ                         |  A ボタン                     |
| FSR 品質モード                        |  X / Y ボタン                 |
| RCAS シャープネス \[0.0(*最もシャープ*) から \> 0.0 (*より少ないシャープ*)\] |  右 / 左ショルダー ボタン |
| RCAS 有効化/無効化                    |  方向パッドの上ボタン         |
| トーンマップの露出                    |  右 / 左トリガー              |
| MIP バイアス調整                      |  方向パッドの左 / 右ボタン    |

# 実装上の注意

## 機能のしくみ

FSR は空間アップスケーラーです。これは、現在のアンチエイリアス
フレームを取得し、それをディスプレイ解像度にアップスケールすることで機能します。FSR
では、現在のフレームのデータのみが必要です。動きベクトルやフレーム履歴は必要ありません。FSR
の中核となるのは、ソース
イメージから高解像度エッジを検出して再作成する最先端のアルゴリズムです。これらの高解像度エッジは、現在のフレームを
\"スーパー解像度\" イメージに変換するために必要な重要な要素です。FSR
は、フレームが移動中であるかどうかに関係なく、一貫したアップスケール品質を提供します。これにより、他の種類のアップスケーラーと比較して品質上の利点が得られます。

FSR は、次の 2 つのメイン パスで構成されます。

-   エッジの再構築を実行する Edge-Adaptive Spatial Upsampling (EASU)
    と呼ばれるアップスケール
    パス。このパスでは、入力フレームがグラデーションの反転について分析され、隣接するグラデーションが入力ピクセルのセットとどのように異なるかを調べます。グラデーションの反転強度により、ディスプレイ解像度での再構築のためにサンプルに適用される重みが決まります。

-   Robust Contrast-Adaptive Sharpening (RCAS) と呼ばれるシャープニング
    パス (アップスケールされたイメージでピクセルの詳細を抽出します)。

このサンプルでは、2 つのパスが計算シェーダーとして実装され、gamma2
色空間データで動作します。

Scarlett および XboxOne プラットフォームで HDR
ディスプレイを使用できる場合、サンプルは HDR
モードで実行されます。デスクトップ プラットフォームでは、サンプルは SDR
モードでのみ実行されます。

このサンプルは動的解像度スタイルで実装されています。そのため、ターゲット解像度のリソースが使用され、アップスケール前により小さい解像度のビューポートを使用してレンダリングされます。

ネイティブ
ターゲット解像度レンダリング、選択可能な低解像度からのバイリニア
アップスケーリング、および選択可能な品質モードからの FSR
アップスケーリングのためのモードがあります。

## ![](./media/image5.png)

## フレーム内の場所

![](./media/image6.png)

FSR パスは、知覚色空間で最適に機能するため、トーン
マッピングの後で統合する必要があります。ノイズやその他の高頻度のビジュアル
コンポーネントをシーンに導入するパスは、ノイズの多いコンポーネントが増幅されないようにするため、アップスケール後にレンダリングする必要があります。

このサンプルでは、次のフレーム構造が適用されます。

![](./media/image7.png)

このサンプルでは、トーンマップ パスによって gamma2 出力が
R10G10B10A2_UNORM リソースに書き込まれ、それが EASU と RCAS
によって消費され、次に拡大鏡パスに渡されます。SDR
では、カラー変換パスによって gamma2 が線形に再変換されます。HDR
では、HDR ディスプレイを接続した場合、カラー変換パスによって gamma2 が
rec2020 に変換されます。

## 必要な定数

定数の処理は、統合を可能な限り単純にする方法で行われます。ヘルパー関数によって設定される
4 つの整数ベクトルがあり、その関数は CPU または GPU
で呼び出すことができます。変数は、既存の定数バッファーに追加し、抽出し、EASU/RCAS
関数に渡すことができます。

このサンプルでは、ヘルパーは CPU で呼び出され、定数は 1
つのバッファーによって提供されます。

> struct FSRConstants
>
> {
>
> DirectX::XMUINT4 Const0;
>
> DirectX::XMUINT4 Const1;
>
> DirectX::XMUINT4 Const2;
>
> DirectX::XMUINT4 Const3;
>
> };
>
> FSRConstants m_fsrConsts;

**EASU**

> FsrEasuCon(
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const0),
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const1),
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const2),
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const3),
>
> inWidth, inHeight, // 拡大する入力イメージ内のビューポート サイズ
> (左上揃え)。
>
> outWidth, outHeight, // 入力イメージのサイズ。
>
> outWidth, outHeight); // 出力の解像度。

上の例は、より大きいリソース内のビューポートにジオメトリがレンダリングされる動的解像度スタイルを対象としています。レンダリングされるリソース
サイズがビューポートと同じである場合は、次のようになります。

> FsrEasuCon(
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const0),
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const1),
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const2),
>
> reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const3),
>
> inWidth, inHeight, // 拡大する入力イメージ内のビューポート サイズ
> (左上揃え)。
>
> inWidth, inHeight, // 入力イメージのサイズ。
>
> outWidth, outHeight); // 出力の解像度。

入力がレターボックス化され、ビューポートが左上に配置されていない状況については、これに対応するために
FsrEasuConOffset 関数が提供されています。

> void FsrEasuConOffset(
>
> outAU4 con0,
>
> outAU4 con1,
>
> outAU4 con2,
>
> outAU4 con3,
>
> AF1 inputViewportInPixelsX,
>
> AF1 inputViewportInPixelsY,
>
> AF1 inputSizeInPixelsX,
>
> AF1 inputSizeInPixelsY,
>
> AF1 outputSizeInPixelsX,
>
> AF1 outputSizeInPixelsY,
>
> AF1 inputOffsetInPixelsX,
>
> AF1 inputOffsetInPixelsY)

**RCAS**

> FsrRcasCon(reinterpret_cast\<AU1\*\>(&m_fsrConsts.Const0),
> m_rcasSharpness);

浮動小数点シャープネス値のスケールは次のとおりです。

> {0.0 := 最大値、から N\>0 まで。N はシャープネスの減少の設定値 (半減)
> の数です}

*このスケールは、FidelityFX CAS
のスケールとは異なることにご注意ください*。

## 品質モード

FSR は、必要な品質とパフォーマンスの比率に応じて、ソース
イメージに適用するスケーリングの量を記述する品質モードを公開しています。

固定スケーリングに加えて、FSR は \"任意スケーリング\"
モードで使用することができます。1x から 4x の面積スケール
ファクターがサポートされています。このモードは通常、動的解像度スケーリングに使用されます。その場合、最小フレーム
レートを実現するために、ソース解像度は固定パフォーマンス予算によって決まります。

| **FSR 1.0 品 質モード**  |  **説明**  |  * *スケール ファ クター** |  **入力\ 解像度**  |  **出力\ 解像度** |
|-------------|----------------------|-----------|----------|----------|
| **" 超高品質"**  |  ***超高品質**モ ードでは、ネイティブ レンダリングと事実 上区別できない品質の イメージが生成されま す。これは、最高の品 質が必要な場合に選択 する必要があります*  |  ディ メンショ ン当たり **1.3x** (面積ス ケールは 1.69x)  |  1477x831 1 970x1108 26 46x1108\ 2 954x1662  |  1 920x1080 2 560x1440 3 440x1440 3 840x2160 |
| * *"高品質"**  |  ***高品質**モ ードでは、ネイティブ レンダリン グの代表的な品質を備 えたスーパー解像度イ メージが生成され、パ フォーマンスがかなり 大きく向上します。*  |  ディ メンショ ン当たり **1.5x** (面積ス ケールは 2.25x)  |  1280x720 1706x960 2293x960 2 560x1440  |  1 920x1080 2 560x1440 3 440x1440 3 840x2160 |
| **" バランス"**  |  ***バランス** モードでは、ネイテ ィブレンダリング品質 に近似するスーパー解 像度イメージが生成さ れ、ネイティブと比較 して大幅にパフォーマ ンスが向上します。*  |  ディ メンショ ン当たり **1.7x** (面積ス ケールは 2.89x)  |  1129x635 1506x847 2024x847 2 259x1270  |  1 920x1080 2 560x1440 3 440x1440 3 840x2160 |
| **"パフォ ーマンス"**  |  ***パフォーマンス** モードでは、 イメージの品質に目に 見える影響があるため 、追加のパフォーマン スが必要な場合にのみ 選択してください。*  |  ディ メンショ ン当たり **2.0x** (面積ス ケールは 4x)  |  960x540 1280x720 1720x720 1 920x1080  |  1 920x1080 2 560x1440 3 440x1440 3 840x2160 |

## 推奨事項

**形式、コンパイラ オプション、浮動小数点パスの選択**

このサンプルでは、FSR パスに 32bpp R10G10B10A2_UNORM
リソースを使用しているため、最高のパフォーマンスが得られます。EASU
パスは通常 ALU バインドであり、RCAS は MEM バインドです。

このサンプルに従って実装する場合、サポートされるプラットフォームに関する推奨事項は次のとおりです。

| プ ラットフォーム |  リソースの種類  |  EASU の推奨事項  |  RCAS の推奨事項 |
|----------------|----------------|-----------------|-----------------|
| **Scarlett**  |  R10 G10B10A2_UNORM |  Wave32、Fp16  |  Wave64、Fp32 |
|  |  R16G 16B16A16_FLOAT |  Wave32、Fp16  |  Wave32、Fp16 |
| **XboxOne**  |  R10 G10B10A2_UNORM |  Fp32  |  Fp32 |
|  |  R16G 16B16A16_FLOAT |  Fp32  |  Fp32 |
| ** デスクトップ** |  R10 G10B10A2_UNORM |  Fp16  |  Fp16 |
|  |  R16G 16B16A16_FLOAT |  Fp16  |  Fp16 |

デバイスのサポートのためにデスクトップ プラットフォームでネイティブ fp16
を使用できない場合は、fp32 が使用されます。

**アンチエイリアス入力**

FSR 1.0 には、アンチエイリアス入力が必要です。品質 AA (TAA や MSAA 8x
など) を使用できない場合、FSR
の使用はお勧めしません。このサンプルでは、基本的な TAA
を使用しています。

**MIP バイアス**

より高品質の出力を得るには、FSR 統合に MIP
バイアスの変更を含める必要があります。このサンプルでは、以下を適用しています。

*MIP バイアス = -log2 (ディスプレイ解像度/ソース解像度)*

**色空間**

FSR パスへの入力は、sRGB や Gamma2
などの知覚色空間にある必要があります。バンディングがあると増幅される可能性があるため、入力にバンディングがあってはなりません。

**動的解像度のための FSR**

FSR
は動的解像度に最適であり、このサンプルでは、入力データが大きなリソースのサブセットである場合に使用する定数を設定する方法を示します。

動的解像度が 100%
でレンダリングされる特殊なケースでは、シームレスなエクスペリエンスを提供するために、EASU
パスはスキップし、RCAS は維持することができます。

**RCAS シャープニング**

RCAS のシャープニング減衰値は、CAS に存在していた値とは異なります。

RCAS では、0.0 は最高レベルのシャープニングであり、N\>0
は適用されるシャープネスのレベルを下げます。

このサンプルの既定の RCAS シャープニング減衰は 0.25 に設定されています。

# 更新履歴

このサンプルは 2021 年 6 月に作成されました。

# プライバシーに関する声明

サンプルをコンパイルして実行する場合、サンプルの使用状況を追跡するために、サンプル実行ファイルのファイル名が
Microsoft に送信されます。このデータ
コレクションからオプトアウトするには、Main.cpp の「Sample Usage
Telemetry」というラベルの付いたコードのブロックを削除します。

全般的な Microsoft のプライバシー ポリシーの詳細については、「[Microsoft
プライバシー
ステートメント](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。

# 免責事項

本ドキュメントで提供される情報は、情報提供のみを目的としており、予告なく変更される可能性があります。このドキュメントを準備するに当たってすべての予防措置を講じましたが、技術的な不正確さ、欠落、文字体裁上の誤りが含まれている可能性があり、AMD
は、この情報を更新または修正する義務を負いません。Advanced Micro
Devices, Inc.
は、本ドキュメントの内容の正確性または完全性に関して一切の表明または保証を行いません。また、AMD
ハードウェア、ソフトウェア、または本ドキュメントに記載されているその他の製品の運用または使用に関して、特定の目的に対する非侵害、商品性、適合性に関する暗黙の保証を含め、いかなる種類の責任も負いません。本ドキュメントにより、いかなる知的財産権に対しても、黙示的または禁反言によるライセンスは付与されません。AMD
の製品の購入または使用に適用される使用条件と制限は、当事者間の署名済み契約または
AMD の標準販売条件に記載されています。

AMD、AMD Arrow ロゴ、Radeon、RDNA、Ryzen、およびその組み合わせは
Advanced Micro Devices, Inc.
の商標です。この文書で使用されているその他の製品名は、識別のみを目的としており、それぞれの会社の商標である可能性があります。

Windows は、米国およびその他の国における Microsoft Corporation
の登録商標です。

Xbox は、米国およびその他の国における Microsoft Corporation
の登録商標です。

© 2021 Advanced Micro Devices, Inc.All rights reserved.
