![](./media/image1.png)

# シェーダー リフレクション ツール

*このサンプルは、Microsoft Game Development Kit と互換性があります (2022 年 3 月)。*

# 説明

このサンプルでは、シェーダー リフレクション情報にアクセスする方法と、それがルート署名にどのように関連しているかを示します。 このサンプルは、GXDK のツールキットのインクルードとライブラリを使用して PC ツールとして実装され、この機能をゲームのシェーダーまたはアセット パイプラインに統合する方法を示します。

# サンプルの使用方法

このツールは、Xbox One または Scarlett シェーダー コンパイラによって生成されたシェーダー オブジェクトを使用します。 シェーダーをオブジェクト ファイルにコンパイルする方法の詳細については、「`dxc.exe /?`」を参照してください。

このツールは、次のコマンド ラインを使用して呼び出すことができます。

`ShaderReflect.exe <shader obj file> [root signature obj file]`

ツールはシェーダー オブジェクト ファイルを読み込み、リフレクション情報をコンソールに出力します。

入力パラメーターと出力パラメーター:

![テーブル、予定表 自動生成された説明](./media/image3.png)

リソース バインドと、ルート署名パラメーター、記述子テーブル、静的サンプラーとの関係:

![低信頼度で自動的に生成された図の説明](./media/image4.png)

再帰構造の内訳を含む定数バッファー レイアウト:

![自動生成されたテーブルの説明](./media/image5.png)

# 実装メモ

このツールは、シェーダー オブジェクト ファイルに埋め込まれたリフレクション データとルート署名データに依存して出力を生成します。

リフレクション データは、シェーダー コンパイラ (dxc.exe) によって生成されるオブジェクト ファイル (STAT チャンク内) に既定で埋め込まれます。 ツール内では、シェーダー コンパイラ ライブラリの DxcUtils ヘルパーを使用して、リフレクション データがオブジェクト モデル (ルート インターフェイスは `ID3D12ShaderReflection`) に変換されます。 コンパイラの `-Qstrip_reflect` オプションを使用する場合は、シェーダー オブジェクトから STAT チャンクを省略できることに注意してください。 `-Fre <file>` オプションを使用してリフレクション情報を別のファイルに保存することもできます (これは、`-Qstrip_reflect` を使用してメイン シェーダー オブジェクト ファイルからリフレクション データを削除する場合でも機能します)。

リフレクション データと同様に、ルート署名データは既定でシェーダー オブジェクト (RTS0 チャンク) に埋め込まれます。 `-Qstrip_rootsignature` を使用して、メイン シェーダー オブジェクトからデータを省略し、`-Frs <file>` を使用して別のファイルに出力できます。

このツールでは、GXDK のツールキットのヘッダー ファイル、ライブラリ、DLL を使用して、PC でリフレクション操作を実行します。 GameCore OS に付属の受信トレイ シェーダー コンパイラ DLL を使用して、Xbox で実行時にリフレクション操作を実行することもできます。

# プラットフォームのサポート

このサンプルは Scarlett および Xbox One プラットフォーム向けに記述されていますが、デスクトップ PC で同じインターフェイスをサポートするように簡単に適応できます。 Windows SDKで提供されるシェーダー コンパイラ ヘッダー、ライブラリ、バイナリは古い傾向があるので、最新の機能とバグ修正を用意するために、最新のリリースを <https://github.com/microsoft/DirectXShaderCompiler> からダウンロードすることをお勧めします。

# 更新履歴

2021 年 11 月 15 日 -- サンプル作成。


