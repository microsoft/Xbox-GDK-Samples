![](./media/image1.png)

# Compute Particles

*이 샘플은 Microsoft 게임 개발 키트(2022년 3월)와 호환됩니다.*

# 설명

이 샘플은 컴퓨팅 셰이더 및 추가 버퍼를 사용하여 기본 입자 시뮬레이션을 수행하고 많은 수의 입자를 렌더링하는 방법을 보여 줍니다.

![](./media/image3.png)

# 샘플 빌드

Xbox One 개발 키트를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.XboxOne.x64`(으)로 설정합니다.

Xbox Series X|S 개발 키트를 사용하는 경우 활성 솔루션 플랫폼을 `Gaming.Xbox.Scarlett.x64`(으)로 설정합니다.

*GDK 설명서의* __샘플 실행__에서 *자세한 내용을 알아보세요.*

# 샘플 사용

이 샘플에서는 다음 컨트롤을 사용합니다.

| 동작 | Gamepad |
|---|---|
| 샘플을 종료합니다. | 선택 |
| 입자 탄력 증가/감소 | 오른쪽/왼쪽 트리거 |
| 카메라 회전 | 왼쪽 및 오른쪽 스틱 |
| 입자 방출기 이동 | 왼쪽 및 오른쪽 스틱 + 오른쪽 숄더 |
| 입자 렌더링 토글 | A 버튼 |
| 입자 업데이트 토글 | B 버튼 |
| 입자 수 늘리기/줄이기 | 방향 패드 위/아래 |

# 구현 참고 사항

이 샘플에서는 D3D11 및 컴퓨팅 셰이더에서 사용할 수 있는 몇 가지 더 비정형적이고 흥미로운 기술을 보여 줍니다. 이 샘플에는 세 가지 흥미로운 부분이 있습니다. 처음 두 가지는 입자를 업데이트하고 선별하는 방법과 관련이 있으며, 세 번째는 컴퓨팅 셰이더 단계의 결과가 일반 렌더링 파이프라인에서 사용되는 방식입니다.

1. **입자 시뮬레이션**

AdvanceParticlesCS 컴퓨팅 셰이더 시뮬레이션 단계에는 두 기본 단계가 포함됩니다. 먼저 입자 위치, 속도, 나이가 UAV 버퍼에서 판독되고 세계 공간에서 시뮬레이션됩니다. 그런 다음, 단순화된 세계 기하 도형(지상 평면 및 구체)에 대한 충돌은 무차별 암호 대입 접근 방식을 사용하여 계산됩니다. 새 위치, 속도 및 나이는 동일한 UAV 버퍼에 다시 기록되어 이전에 읽은 데이터를 덮어씁니다.

2. **입자 컬 및 쓰기**

간단한 평면 컬링 알고리즘이 각 입자에 적용되어 뷰 절두체 내에 표시되는지 여부를 고려합니다. 입자가 표시되면 렌더링을 위해 추가 버퍼에 해당 위치가 추가됩니다.

`ID3D12Device::CreateUnorderedAccessView(...)` API를 사용하여 버퍼 리소스의 UAV(순서가 지정되지 않은 액세스 뷰)를 만들고 두 번째 리소스를 'pCounterResource' 매개 변수로 지정함으로써 추가 버퍼를 사용할 수 있습니다. 추가 버퍼의 현재 개수(32비트 부호 없는 정수 1개)를 저장하려면 카운터 리소스가 4바이트 이상이어야 합니다. 또한 카운터 리소스의 UAV도 생성되어 `ID3D12GraphicsCommandList::ClearUnorderedAccessViewUint(...)` API를 통해 각 프레임의 개수를 지울 수 있습니다. 생성된 후에는 버퍼를 `AppendStructuredBuffer<...>`(으)로 선언된 UAV 셰이더 슬롯에 바인딩하기만 하면 됩니다.

AdvanceParticlesCS 컴퓨팅 셰이더는 활성 입자 인스턴스를 추가 버퍼에 시뮬레이션하고 추가합니다. 완료되면 `ID3D12GraphicsCommandList::CopyBufferRegion(...)` API를 사용하여 카운터 리소스의 입자 개수를 `ID3D12GraphicsCommandList::ExecuteIndirect(...)` API에 대한 입력으로 사용할 수 있는 간접 인수 버퍼 리소스로 복사합니다. 이를 통해 AdvanceParticlesCS의 frustum-cull 테스트에서 결정된 표시되는 입자만 그릴 수 있습니다.

3. **렌더링**

`ID3D12GraphicsCommandList::ExecuteIndirect(...)` API는 입자 렌더링을 디스패치하는 데 사용됩니다. `ID3D12Device::CreateCommandSignature(...)`을(를) 사용하여 만든 명령 서명은 ExecuteIndirect가 디스패치할 명령 유형을 지정하는 데 필요합니다. 명령 유형은 간접 인수 버퍼의 내용을 해석하는 방법을 결정합니다. 이 경우 명령 유형은 `ID3D12GraphicsCommandList::DrawInstanced(...)` API(32비트 부호 없는 정수 4개)와 관련 있는 'Draw'입니다. VertexCountPerInstance를 4로 하드 코딩하고 각 프레임의 InstanceCount 위치에 입자 수를 복사합니다.

꼭짓점 특성은 꼭짓점 셰이더에서 상수 조회 테이블로 하드 코딩됩니다. 꼭짓점 ID(SV_VertexID)는 각 꼭짓점의 특성에 액세스하기 위해 이 조회 테이블에 인덱싱하는 데 사용됩니다. 인스턴스 ID(SV_InstanceID)는 각 인스턴스의 속성에 액세스하기 위해 입자 인스턴스 버퍼에 인덱싱하는 데 사용됩니다.

# 업데이트 기록

2019년 3월 -- 레거시 Xbox 샘플 프레임워크에서 새 템플릿으로 포팅.

# 개인정보처리방침

샘플을 컴파일하고 실행하는 경우 샘플 사용량을 추적할 수 있도록 샘플 실행 파일의 파일 이름이 Microsoft에 전송됩니다. 이 데이터 수집을 옵트아웃하려면 Main.cpp에서 "샘플 사용량 원격 분석"이라는 레이블이 지정된 코드 블록을 제거할 수 있습니다.

일반적인 Microsoft의 개인 정보 정책에 대한 자세한 내용은 [Microsoft 개인정보처리방침](https://privacy.microsoft.com/en-us/privacystatement/)을 참조하세요.


