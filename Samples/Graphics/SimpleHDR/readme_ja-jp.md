# SimpleHDR サンプル

*このサンプルは Microsoft Game Development Kit (2020 年 8 月)
と互換性があります*

# 説明

これは、Xbox で HDR を実装する方法を示す簡単なサンプルです。

![Shape Description automatically generated](./media/image1.png)

# サンプルのビルド

Xbox One 開発キットを使用している場合、アクティブ ソリューション
プラットフォームを Gaming.Xbox.XboxOne.x64 に設定します。

Project Scarlett を使用する場合は、アクティブ ソリューション
プラットフォームを Gaming.Xbox.Scarlett.x64 に設定します。

*詳細については、GDK のドキュメントの*
「サンプルの実行」*を参照してください。*

# サンプルの使用

このサンプルは、次のコントロールを使用します。

| 操作                                           |  ゲームパッド        |
|------------------------------------------------|---------------------|
| 終了                                           |  ビュー ボタン       |

# 実装上の注意

HDR の場合、Xbox コンソールは、ST.2084 ガンマ曲線を持つ Rec.2020
色空間にあるテレビに値を送信する必要があります。Xbox One
と比較すると、これを処理するためのタイトルの要件やオプションが異なっています。スワップ
バッファーフォーマット、色空間フォーマット、シェーダー出力に関する Xbox
Series コンソール。システムには、GameDVR とストリーミングの目的で SDR
イメージも必要です。タイトルは、この SDR イメージを 2 番目のスワップ
チェーン バッファーにレンダリングするか、自動トーン
マッピングを使用してシステムにこのイメージを自動的に生成させることができます。

**[Xbox One]{.underline}**

Xbox Oneでは、スワップ チェーン バッファーは
DXGI_FORMAT_R10G10B10A2_UNORM形式を使用する必要があり、スワップ
チェーンの色空間フラグは、DXGI_COLOR_SPACE_RGB_FULL\_**G2084**\_NONE\_**P2020**
である必要があります。このフラグの意味を解読するのは簡単です。タイトル
シェーダーは、**ST.2084** ガンマ曲線が適用された **Rec.2020**
色空間のスワップ チェーンに値を書き出すようにグラフィックス
ドライバーに伝えるものです。

自動トーン マッピングを選択するために、タイトルはスワップ
チェーンの作成にD3D12XBOX_RESOURCE_FLAG_ALLOW_AUTOMATIC_GAMEDVR_TONE_MAPフラグを追加します。このシナリオでは、ドライバーは余分なスワップ
チェーンを内部的に割り当て、計算シェーダーを挿入してタイトルの HDR
イメージをトーン マップして SDR
イメージを生成することに注意してください。シェーダーを組み合わせて独自のトーン
マッピングを行う方が、タイトルにとってパフォーマンスが高い場合があります。PIX
では、ドライバーの自動トーン マッピング シェーダーは、Present
呼び出しの直前に PIX という名前のイベント \[HDR Auto Tonemap\]
で識別できます。

**[Xbox シリーズ]{.underline}**

Xbox シリーズ コンソールでは、スワップ
チェーンはDXGI_FORMAT_R9G9B9E5_SHAREDEXPまたはDXGI_FORMAT_R10G10B10A2_UNORMのいずれかになります。DXGI_FORMAT\_**R9G9B9E5**\_SHAREDEXPを使用すると、タイトルに高精度の値を表示できるので、この使用を推奨します。

スワップ チェーンの色空間フラグは、GPU
で何が行われるか、およびディスプレイ
ハードウェアにオフロードされる内容を制御する、多くのフラグの1つです。DXGI_COLOR_SPACE_RGB_FULL\_**G10**\_NONE\_**D65P3**
を使用することをお勧めします。このフラグの意味を解読することは、Xbox One
に似ています。たとえば、前のフラグは、シェーダーが P3-D65 色空間で線形値
、つまりガンマ 1.0
を出力することをドライバーに指示します。つまり、ディスプレイ
ハードウェアは色の値を Rec.2020 に変換し、ST.2084
ガンマ曲線を適用します。この推奨事項の最大の理由は、ほとんどの HDR
テレビが P3 色の値を表示、またはほぼ表示できるためです。タイトルが単に
Rec.709
色を出力する場合、そのタイトルはテレビの表示機能が十分に生かしきれていません。このサンプルでは、明るい色をよりカラフルにし、画像のほとんどを同じに保つための単純な色域拡張を示しています。

自動トーン マッピングを使用するために、Xbox One
のように余計なフラグを指定する必要がなく、1つのスワップチェーンを提示するだけでよいのです。CPU、GPU、メモリ、帯域幅の追加コストも発生せず、すべてディスプレイ
ハードウェアで処理されます。

ハードウェアを表示するために処理の一部をオフロードできることは、特に
Lockahrt コンソールで非常に有益です/

# 既知の問題

なし

# プライバシーに関する声明

サンプルをコンパイルして実行する場合、サンプルの使用状況を追跡するために、サンプル実行ファイルのファイル名が
Microsoft に送信されます。このデータ
コレクションからオプトアウトするには、Main.cpp の「Sample Usage
Telemetry」というラベルの付いたコードのブロックを削除します。

全般的な Microsoft のプライバシー ポリシーの詳細については、「[Microsoft
プライバシー
ステートメント](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。
