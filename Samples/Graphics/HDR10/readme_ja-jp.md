# 簡単な HDR のサンプル

*このサンプルは、Microsoft ゲーム開発キットのプレビュー (2019 年 11 月)
に対応しています。*

# 説明

このサンプルは、UHD TV を HDR モードに切り替えて、x を超える値を使用して
HDR シーンを 1.0f 以上でレンダリングします。そのため UHD TV
では白色より明るく表示されます。このサンプルでは、使用する API
の表示、HDR スワップ チェーンの作成方法、1.0f より大きい様々な値の UHD
TV での表示方法について示すことを目的としています。

![A picture containing timeline Description automatically generated](./media/image1.png)

![Text Description automatically generated](./media/image2.png)

# サンプルの作成

Xbox One の devkit を使用している場合は、アクティブなソリューション
プラットフォームを Gaming.Xbox.XboxOne.x64 に設定します。

Project Scarlett を使用している場合は、アクティブなソリューション
プラットフォームを Gaming.Xbox.Scarlett.x64 に設定します。

*詳細については、GDK ドキュメントの*
「サンプルの実行」*を参照してください。*

# サンプルの使用

サンプルでは、次のコントロールが使用されます。

| 動作                                           |  ゲームパッド        |
|------------------------------------------------|---------------------|
| ST.2084 曲線の表示に切り替える                 |  A ボタン            |
| ペ ーパーホワイトのブロックのみの表示に切り替える |  B ボタン |
| ペーパーホワイトの明るさを調整する             |  方向パッド          |
| 値を調整する                                   |  左右のスティック    |
| 終了する                                       |  表示ボタン          |

# 実装に関する注意事項

このサンプルでは、API を使用して、付属のディスプレイが HDR
に対応しているかどうかを判断します。対応している場合、表示は HDR
モードに切り替わります。FP16 バックバッファーに、1.0f
以上の値を含む非常にシンプルな HDR シーンがレンダリングされ、2
つの異なるスワップチェーン (HDR 用と SDR 用に 1つずつ)
が出力されます。ユーザーが HDR
ディスプレイを使用している場合でも、GameDVR とスクリーン ショットに SDR
シグナルが必要です。

このサンプルには、HDR および SDR スワップ チェーンをどちらもサポートする
[DeviceResources](https://github.com/Microsoft/DirectXTK12/wiki/DeviceResources)
クラスのバージョンが含まれています。

ホワイトペーパー『[Xbox の Xbox
One](http://aka.ms/hdr-on-xbox-one)』を参照してください。

これまで、ゲームは Rec.709 の原色および Rec.709 ガンマ曲線を使用して SDR
シグナルを出力していました。UHD ディスプレイの新機能の 1
つは、広範囲の色域 (WCG)
です。これを使用するには、新しいカラー領域、Rec.2020
の原色を使用する必要があります。UHD ディスプレイのもう 1
つの新しい機能は、高ダイナミック レンジ (HDR)
です。これを使用するには、別の曲線 (ST.2084 曲線)
を使用する必要があります。したがって、HDR
シグナルを出力するには、Rec.2020 原色と ST.2084
曲線を使用する必要があります。

SDR シグナルを表示するには、シンプルなトーンマッピング
シェーダーを適用して、HDR シーンで 1.0f
を超えるすべての値をクリップし、Rec.709 原色を使用して 8
ビット値を出力するだけです。追加のトーンマッピング演算子については、
*DirectX Tool Kit for DirectX 12*
の[PostProcess](https://github.com/Microsoft/DirectXTK12/wiki/PostProcess)
クラスを参照してください。

HDR シグナルを表示するには、シェーダーを使用して、Rec.709 原色を
Rec.2020 原色に変換し、次に ST.2084 曲線を適用して HDR
が正しく表示できる 10 ビット値に変換します。HDR
ディスプレイの出力の白色度と輝度は、「ペーパーホワイト」の定義に選択した
nits の値により決定されます。SDR の仕様では、「ペーパーホワイト」は 80
nits
と定義されていますが、これは暗い環境の映画館向けです。今日のユーザーが使用するのはより明るい白で、例えばスマートフォンでは最大
550 nits (日光下でも表示できるようにするため)、PC モニターでは 200～300
nits、SDR TV では 120～150 nits です。「ペーパーホワイト」の nits
は、方向パッドの上下を使用してサンプルで調整できます。白の横に明るい値が表示すると、目の錯覚が生じる場合があるため、「ペーパーホワイト」のブロックのみを表示する場合は
A ボタンを使用して切り替えることができます。

このサンプルには、2 つのモードがあります。

-   シーン内で特定の値を含むブロックをレンダリングする

-   特定の輝度の値 (nits) を使用して ST.2084 曲線をレンダリングする

# 既知の問題

ここでは Project Scarlett
の実装は機能していますが、今後の更新で、自動色調マッピングを活用した簡単な方法を提供します。これにより、Project
Scarlett のタイトルは HDR 画像のみを表示することができ、SDR 出力と
GameDVR はシステムで完全に処理されます。

# プライバシーに関する声明

サンプルをコンパイルして実行すると、サンプルの使用状況を追跡するため、サンプル実行可能ファイルのファイル名が
Microsoft に送信されます。このデータ収集を無効にするには、「Sample Usage
Telemetry」とラベル付けされた Main.cpp
内のコードのブロックを削除します。

Microsoft のプライバシー方針の詳細については、「[Microsoft プライバシー
ステートメント](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。
