![](./media/image1.png)

# 単純なインスタンス化のサンプル

*このサンプルは Microsoft Game Development Kit (2020 年 6 月) と互換性があります*

# 説明

このサンプルは、Direct3D 12 API でインスタンス作成を使用する方法を示します。

# サンプルのビルド

Xbox One 開発キットを使用している場合は、アクティブなソリューション プラットフォームを `Gaming.Xbox.XboxOne.x64` に設定します。

Xbox One X|S 開発キットを使用している場合は、アクティブなソリューション プラットフォームを `Gaming.Xbox.Scarlett.x64` に設定します。

*詳細については、**GDK ドキュメント*の「__サンプルの実行__」 を参照してください。

# サンプルの使用方法

![](./media/image3.png)

| 操作 | ゲームパッド |
|---|---|
| カメラを回転させる | 左サムスティック |
| インスタンス数を変更する | LB / RB |
| シミュレーションをリセットする | A |
| Exit | ビュー ボタン |

# 実装メモ

インスタンス化されたジオメトリをレンダリングする際に考慮すべき領域が 4 つあります。

1. **ジオメトリ データ**

> このサンプルの場合、これには
> キューブの面を記述する頂点とインデックスを含む、頂点とインデックス バッファーが含まれます。 これは、
> このキューブを世界にレンダリングするために必要な*パイプライン状態オブジェクト* も
> 含まれています。 これらすべてのコンポーネントは、
> インスタンス化されていないジオメトリと同じ方法で設定および操作されます。 (参照:
> SimpleInstancing.cpp の「*CreateDeviceDependentResources*」)

2. **インスタンス データ**

> 標準 D3D12 インスタンスレンダリングの場合、インスタンスごとのデータは
> 1 つ以上の頂点バッファーを介して提供されます。 これらの頂点バッファーは、
> 他の頂点バッファーと同じ方法で作成されます。 このサンプルでは、
> 2 つの頂点バッファーを使用します。 1 つは静的で、インスタンスごとのカラーデータを含みます
> (サンプルの有効期間中は変更されません)。 もう 1 つは
> 動的で、インスタンスごとの位置と方向の情報が含まれます
> (フレームごとに変更されます)。

3. **インスタンス化レイアウト**

> インスタンス化されたジオメトリをレンダリングするには、D3D に
> 指定された頂点データの解釈方法に関する情報が必要です。 これは、標準のレンダリングとほぼ同じ方法で、
> *D3D12_INPUT_ELEMENT_DESC* 構造体の配列を
> 使用して行われます。 ただし、この構造には、その他の要素が追加されます。
> 構造体によって使用されます。 ジオメトリ データは
> *D3D12_INPUT_CLASSIFICATION_PER_VERTEX_DATA* 値
> (*InputSlotClass* 要素の) でフラグが設定されますが、インスタンスごとのデータでは
> *D3D12_INPUT_CLASSIFICATION_PER_INSTANCE_DATA* 値が使用されます。 *InputSlot*
> 要素は、各データの取得元の頂点ストリームを
> 示すためにも使用されます。
>
> 頂点シェーダーは、ジオメトリ データとインスタンスごとのデータが
> すべてまとめられているかのように定義された頂点構造を使用します (これは、
> *D3D12_INPUT_ELEMENT_DESC* で説明されているレイアウトを
> 反映します)。
>
> ***注:** このサンプルでは* D3D12_APPEND_ALIGNED_ELEMENT
> AlignedByteOffset 要素の *定数* *使用して、入力レイアウトで
> データを自動的に正しく配置します。 これは、問題の頂点バッファーの構造に
> 正しく整列されたデータが含まれている場合にのみ機能します。 状況
> 頂点データ内の要素をスキップ (または無視) する場合は、
> 正確な位置合わせオフセットが必要になります。*

4. **レンダリング**

> インスタンス化されたデータのレンダリングは、前のポイントを
> 見極めれば簡単です。 *ID3D12GraphicsCommandList::IASetVertexBuffers* API を使用して
> 入力として使用される頂点バッファーを設定し (この場合、入力
> バッファー)、*ID3D12GraphicsCommandList::DrawIndexedInstanced*
> API を使用してレンダリングします。 残りのレンダリング設定は、
> 標準の非インスタンスレンダリングと同じように実行されます。

# プライバシーに関する声明

サンプルをコンパイルして実行する場合、サンプルの使用状況を追跡するために、サンプルの実行可能ファイルのファイル名が Microsoft に送信されます。 このデータ コレクションからオプトアウトするには、Main.cpp の "サンプル使用状況テレメトリ" というラベルの付いたコードのブロックを削除します。

Microsoft のプライバシー ポリシー全般の詳細については、「[Microsoft のプライバシーに関する声明](https://privacy.microsoft.com/en-us/privacystatement/)」を参照してください。


